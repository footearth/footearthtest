<html lang="en">
<head>
<title>Array Sorting - The GNU Awk User's Guide</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="The GNU Awk User's Guide">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Arrays.html#Arrays" title="Arrays">
<link rel="prev" href="Multi_002dscanning.html#Multi_002dscanning" title="Multi-scanning">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
Copyright (C) 1989, 1991, 1992, 1993, 1996, 1997, 1998, 1999,
2000, 2001, 2002, 2003, 2004, 2005, 2007, 2009 Free Software Foundation, Inc.



   This is Edition 3 of `GAWK: Effective AWK Programming: A User's Guide for GNU Awk',
for the 3.1.7 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being ``GNU General Public License'', the Front-Cover
texts being (a) (see below), and with the Back-Cover Texts being (b)
(see below).  A copy of the license is included in the section entitled
``GNU Free Documentation License''.
  a. ``A GNU Manual''

  b. ``You have the freedom to copy and modify this GNU manual.  Buying
     copies from the FSF supports it in developing GNU and promoting
     software freedom.''
        -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Array-Sorting"></a>
<p>
Previous:&nbsp;<a rel="previous" accesskey="p" href="Multi_002dscanning.html#Multi_002dscanning">Multi-scanning</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Arrays.html#Arrays">Arrays</a>
<hr>
</div>

<h3 class="section">7.11 Sorting Array Values and Indices with <samp><span class="command">gawk</span></samp></h3>

<p><a name="index-arrays_002c-sorting-1137"></a><a name="index-g_t_0040code_007basort_007d-function-_0028_0040command_007bgawk_007d_0029-1138"></a><a name="index-g_t_0040code_007basort_007d-function-_0028_0040command_007bgawk_007d_0029_002c-arrays_0040comma_007b_007d-sorting-1139"></a><a name="index-sort-function_002c-arrays_002c-sorting-1140"></a>The order in which an array is scanned with a &lsquo;<samp><span class="samp">for (i in array)</span></samp>&rsquo;
loop is essentially arbitrary. 
In most <samp><span class="command">awk</span></samp> implementations, sorting an array requires
writing a <code>sort</code> function. 
While this can be educational for exploring different sorting algorithms,
usually that's not the point of the program. 
<samp><span class="command">gawk</span></samp> provides the built-in <code>asort</code>
and <code>asorti</code> functions
(see <a href="String-Functions.html#String-Functions">String Functions</a>)
for sorting arrays.  For example:

<pre class="example">     <var>populate the array</var> data
     n = asort(data)
     for (i = 1; i &lt;= n; i++)
         <var>do something with</var> data[i]
</pre>
   <p>After the call to <code>asort</code>, the array <code>data</code> is indexed from 1
to some number <var>n</var>, the total number of elements in <code>data</code>. 
(This count is <code>asort</code>'s return value.) 
<code>data[1]</code> &lt;= <code>data[2]</code> &lt;= <code>data[3]</code>, and so on. 
The comparison of array elements is done
using <samp><span class="command">gawk</span></samp>'s usual comparison rules
(see <a href="Typing-and-Comparison.html#Typing-and-Comparison">Typing and Comparison</a>).

   <p><a name="index-side-effects_002c-_0040code_007basort_007d-function-1141"></a>An important side effect of calling <code>asort</code> is that
<em>the array's original indices are irrevocably lost</em>. 
As this isn't always desirable, <code>asort</code> accepts a
second argument:

<pre class="example">     <var>populate the array</var> source
     n = asort(source, dest)
     for (i = 1; i &lt;= n; i++)
         <var>do something with</var> dest[i]
</pre>
   <p>In this case, <samp><span class="command">gawk</span></samp> copies the <code>source</code> array into the
<code>dest</code> array and then sorts <code>dest</code>, destroying its indices. 
However, the <code>source</code> array is not affected.

   <p>Often, what's needed is to sort on the values of the <em>indices</em>
instead of the values of the elements. 
To do that, starting with <samp><span class="command">gawk</span></samp> 3.1.2, use the
<code>asorti</code> function.  The interface is identical to that of
<code>asort</code>, except that the index values are used for sorting, and
become the values of the result array:

<pre class="example">     { source[$0] = some_func($0) }
     
     END {
         n = asorti(source, dest)
         for (i = 1; i &lt;= n; i++) {
             <var>do something with</var> dest[i]             <i>Work with sorted indices directly</i>
             ...
             <var>do something with</var> source[dest[i]]     <i>Access original array via sorted indices</i>
         }
     }
</pre>
   <p>If your version of <samp><span class="command">gawk</span></samp> is 3.1.0 or 3.1.1, you don't
have <code>asorti</code>. Instead, use a helper array
to hold the sorted index values, and then access the original array's
elements.  It works in the following way:

<pre class="example">     <var>populate the array</var> data
     # copy indices
     j = 1
     for (i in data) {
         ind[j] = i    # index value becomes element value
         j++
     }
     n = asort(ind)    # index values are now sorted
     for (i = 1; i &lt;= n; i++) {
         <var>do something with</var> ind[i]           <i>Work with sorted indices directly</i>
         ...
         <var>do something with</var> data[ind[i]]     <i>Access original array via sorted indices</i>
     }
</pre>
   <p>Sorting the array by replacing the indices provides maximal flexibility. 
To traverse the elements in decreasing order, use a loop that goes from
<var>n</var> down to 1, either over the elements or over the indices.

   <p><a name="index-reference-counting_002c-sorting-arrays-1142"></a>Copying array indices and elements isn't expensive in terms of memory. 
Internally, <samp><span class="command">gawk</span></samp> maintains <dfn>reference counts</dfn> to data. 
For example, when <code>asort</code> copies the first array to the second one,
there is only one copy of the original array elements' data, even though
both arrays use the values.  Similarly, when copying the indices from
<code>data</code> to <code>ind</code>, there is only one copy of the actual index
strings.

<!-- Document It And Call It A Feature. Sigh. -->
   <p><a name="index-arrays_002c-sorting_002c-_0040code_007bIGNORECASE_007d-variable-and-1143"></a><a name="index-g_t_0040code_007bIGNORECASE_007d-variable_002c-array-sorting-and-1144"></a>We said previously that comparisons are done using <samp><span class="command">gawk</span></samp>'s
&ldquo;usual comparison rules.&rdquo;  Because <code>IGNORECASE</code> affects
string comparisons, the value of <code>IGNORECASE</code> also
affects sorting for both <code>asort</code> and <code>asorti</code>. 
Caveat Emptor. 
<!-- ENDOFRANGE arrs -->

   </body></html>

