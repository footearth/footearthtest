<html lang="en">
<head>
<title>Id Program - The GNU Awk User's Guide</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="The GNU Awk User's Guide">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Clones.html#Clones" title="Clones">
<link rel="prev" href="Egrep-Program.html#Egrep-Program" title="Egrep Program">
<link rel="next" href="Split-Program.html#Split-Program" title="Split Program">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
Copyright (C) 1989, 1991, 1992, 1993, 1996, 1997, 1998, 1999,
2000, 2001, 2002, 2003, 2004, 2005, 2007, 2009 Free Software Foundation, Inc.



   This is Edition 3 of `GAWK: Effective AWK Programming: A User's Guide for GNU Awk',
for the 3.1.7 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being ``GNU General Public License'', the Front-Cover
texts being (a) (see below), and with the Back-Cover Texts being (b)
(see below).  A copy of the license is included in the section entitled
``GNU Free Documentation License''.
  a. ``A GNU Manual''

  b. ``You have the freedom to copy and modify this GNU manual.  Buying
     copies from the FSF supports it in developing GNU and promoting
     software freedom.''
        -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Id-Program"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="Split-Program.html#Split-Program">Split Program</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Egrep-Program.html#Egrep-Program">Egrep Program</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Clones.html#Clones">Clones</a>
<hr>
</div>

<h4 class="subsection">13.2.3 Printing out User Information</h4>

<p><a name="index-printing_002c-user-information-1776"></a><a name="index-users_002c-information-about_002c-printing-1777"></a><a name="index-g_t_0040command_007bid_007d-utility-1778"></a>The <samp><span class="command">id</span></samp> utility lists a user's real and effective user ID numbers,
real and effective group ID numbers, and the user's group set, if any. 
<samp><span class="command">id</span></samp> only prints the effective user ID and group ID if they are
different from the real ones.  If possible, <samp><span class="command">id</span></samp> also supplies the
corresponding user and group names.  The output might look like this:

<pre class="example">     $ id
     -| uid=2076(arnold) gid=10(staff) groups=10(staff),4(tty)
</pre>
   <p>This information is part of what is provided by <samp><span class="command">gawk</span></samp>'s
<code>PROCINFO</code> array (see <a href="Built_002din-Variables.html#Built_002din-Variables">Built-in Variables</a>). 
However, the <samp><span class="command">id</span></samp> utility provides a more palatable output than just
individual numbers.

   <p>Here is a simple version of <samp><span class="command">id</span></samp> written in <samp><span class="command">awk</span></samp>. 
It uses the user database library functions
(see <a href="Passwd-Functions.html#Passwd-Functions">Passwd Functions</a>)
and the group database library functions
(see <a href="Group-Functions.html#Group-Functions">Group Functions</a>):

   <p>The program is fairly straightforward.  All the work is done in the
<code>BEGIN</code> rule.  The user and group ID numbers are obtained from
<code>PROCINFO</code>. 
The code is repetitive.  The entry in the user database for the real user ID
number is split into parts at the &lsquo;<samp><span class="samp">:</span></samp>&rsquo;. The name is the first field. 
Similar code is used for the effective user ID number and the group
numbers:

   <p><a name="index-g_t_0040code_007bid_002eawk_007d-program-1779"></a>
<pre class="example">     <!-- file eg/prog/id.awk -->
     # id.awk --- implement id in awk
     #
     # Requires user and group library functions
     <!-- endfile -->
     <!-- file eg/prog/id.awk -->
     # output is:
     # uid=12(foo) euid=34(bar) gid=3(baz) \
     #             egid=5(blat) groups=9(nine),2(two),1(one)
     
     BEGIN    \
     {
         uid = PROCINFO["uid"]
         euid = PROCINFO["euid"]
         gid = PROCINFO["gid"]
         egid = PROCINFO["egid"]
     
         printf("uid=%d", uid)
         pw = getpwuid(uid)
         if (pw != "") {
             split(pw, a, ":")
             printf("(%s)", a[1])
         }
     
         if (euid != uid) {
             printf(" euid=%d", euid)
             pw = getpwuid(euid)
             if (pw != "") {
                 split(pw, a, ":")
                 printf("(%s)", a[1])
             }
         }
     
         printf(" gid=%d", gid)
         pw = getgrgid(gid)
         if (pw != "") {
             split(pw, a, ":")
             printf("(%s)", a[1])
         }
     
         if (egid != gid) {
             printf(" egid=%d", egid)
             pw = getgrgid(egid)
             if (pw != "") {
                 split(pw, a, ":")
                 printf("(%s)", a[1])
             }
         }
     
         for (i = 1; ("group" i) in PROCINFO; i++) {
             if (i == 1)
                 printf(" groups=")
             group = PROCINFO["group" i]
             printf("%d", group)
             pw = getgrgid(group)
             if (pw != "") {
                 split(pw, a, ":")
                 printf("(%s)", a[1])
             }
             if (("group" (i+1)) in PROCINFO)
                 printf(",")
         }
     
         print ""
     }
     <!-- endfile -->
</pre>
   <p><a name="index-g_t_0040code_007bin_007d-operator-1780"></a>The test in the <code>for</code> loop is worth noting. 
Any supplementary groups in the <code>PROCINFO</code> array have the
indices <code>"group1"</code> through <code>"group</code><var>N</var><code>"</code> for some
<var>N</var>, i.e., the total number of supplementary groups. 
However, we don't know in advance how many of these groups
there are.

   <p>This loop works by starting at one, concatenating the value with
<code>"group"</code>, and then using <code>in</code> to see if that value is
in the array.  Eventually, <code>i</code> is incremented past
the last group in the array and the loop exits.

   <p>The loop is also correct if there are <em>no</em> supplementary
groups; then the condition is false the first time it's
tested, and the loop body never executes.

<!-- exercise!!! -->
   </body></html>

