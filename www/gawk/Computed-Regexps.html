<html lang="en">
<head>
<title>Computed Regexps - The GNU Awk User's Guide</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="The GNU Awk User's Guide">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Regexp.html#Regexp" title="Regexp">
<link rel="prev" href="Leftmost-Longest.html#Leftmost-Longest" title="Leftmost Longest">
<link rel="next" href="Locales.html#Locales" title="Locales">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
Copyright (C) 1989, 1991, 1992, 1993, 1996, 1997, 1998, 1999,
2000, 2001, 2002, 2003, 2004, 2005, 2007, 2009 Free Software Foundation, Inc.



   This is Edition 3 of `GAWK: Effective AWK Programming: A User's Guide for GNU Awk',
for the 3.1.7 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being ``GNU General Public License'', the Front-Cover
texts being (a) (see below), and with the Back-Cover Texts being (b)
(see below).  A copy of the license is included in the section entitled
``GNU Free Documentation License''.
  a. ``A GNU Manual''

  b. ``You have the freedom to copy and modify this GNU manual.  Buying
     copies from the FSF supports it in developing GNU and promoting
     software freedom.''
        -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Computed-Regexps"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="Locales.html#Locales">Locales</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Leftmost-Longest.html#Leftmost-Longest">Leftmost Longest</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Regexp.html#Regexp">Regexp</a>
<hr>
</div>

<h3 class="section">2.8 Using Dynamic Regexps</h3>

<!-- STARTOFRANGE dregexp -->
<p><a name="index-regular-expressions_002c-computed-324"></a><!-- STARTOFRANGE regexpd -->
<a name="index-regular-expressions_002c-dynamic-325"></a><a name="index-g_t_0040code_007b_007e_007d-_0028tilde_0029_002c-_0040code_007b_007e_007d-operator-326"></a><a name="index-tilde-_0028_0040code_007b_007e_007d_0029_002c-_0040code_007b_007e_007d-operator-327"></a><a name="index-g_t_0040code_007b_0021_007d-_0028exclamation-point_0029_002c-_0040code_007b_0021_007e_007d-operator-328"></a><a name="index-exclamation-point-_0028_0040code_007b_0021_007d_0029_002c-_0040code_007b_0021_007e_007d-operator-329"></a><!-- @cindex operators, @code{~} -->
<!-- @cindex operators, @code{!~} -->
The righthand side of a &lsquo;<samp><span class="samp">~</span></samp>&rsquo; or &lsquo;<samp><span class="samp">!~</span></samp>&rsquo; operator need not be a
regexp constant (i.e., a string of characters between slashes).  It may
be any expression.  The expression is evaluated and converted to a string
if necessary; the contents of the string are used as the
regexp.  A regexp that is computed in this way is called a <dfn>dynamic
regexp</dfn>:

<pre class="example">     BEGIN { digits_regexp = "[[:digit:]]+" }
     $0 ~ digits_regexp    { print }
</pre>
   <p class="noindent">This sets <code>digits_regexp</code> to a regexp that describes one or more digits,
and tests whether the input record matches this regexp.

   <p><strong>Caution:</strong> When using the &lsquo;<samp><span class="samp">~</span></samp>&rsquo; and &lsquo;<samp><span class="samp">!~</span></samp>&rsquo;
operators, there is a difference between a regexp constant
enclosed in slashes and a string constant enclosed in double quotes. 
If you are going to use a string constant, you have to understand that
the string is, in essence, scanned <em>twice</em>: the first time when
<samp><span class="command">awk</span></samp> reads your program, and the second time when it goes to
match the string on the lefthand side of the operator with the pattern
on the right.  This is true of any string-valued expression (such as
<code>digits_regexp</code>, shown previously), not just string constants.

   <p><a name="index-regexp-constants_002c-slashes-vs_002e_0040_003a-quotes-330"></a><a name="index-g_t_0040code_007b_005c_007d-_0028backslash_0029_002c-regexp-constants-331"></a><a name="index-backslash-_0028_0040code_007b_005c_007d_0029_002c-regexp-constants-332"></a><a name="index-g_t_0040code_007b_0022_007d-_0028double-quote_0029_002c-regexp-constants-333"></a><a name="index-double-quote-_0028_0040code_007b_0022_007d_0029_002c-regexp-constants-334"></a>What difference does it make if the string is
scanned twice? The answer has to do with escape sequences, and particularly
with backslashes.  To get a backslash into a regular expression inside a
string, you have to type two backslashes.

   <p>For example, <code>/\*/</code> is a regexp constant for a literal &lsquo;<samp><span class="samp">*</span></samp>&rsquo;. 
Only one backslash is needed.  To do the same thing with a string,
you have to type <code>"\\*"</code>.  The first backslash escapes the
second one so that the string actually contains the
two characters &lsquo;<samp><span class="samp">\</span></samp>&rsquo; and &lsquo;<samp><span class="samp">*</span></samp>&rsquo;.

   <p><a name="index-troubleshooting_002c-regexp-constants-vs_002e_0040_003a-string-constants-335"></a><a name="index-regexp-constants_002c-vs_002e_0040_003a-string-constants-336"></a><a name="index-string-constants_002c-vs_002e_0040_003a-regexp-constants-337"></a>Given that you can use both regexp and string constants to describe
regular expressions, which should you use?  The answer is &ldquo;regexp
constants,&rdquo; for several reasons:

     <ul>
<li>String constants are more complicated to write and
more difficult to read. Using regexp constants makes your programs
less error-prone.  Not understanding the difference between the two
kinds of constants is a common source of errors.

     <li>It is more efficient to use regexp constants. <samp><span class="command">awk</span></samp> can note
that you have supplied a regexp and store it internally in a form that
makes pattern matching more efficient.  When using a string constant,
<samp><span class="command">awk</span></samp> must first convert the string into this internal form and
then perform the pattern matching.

     <li>Using regexp constants is better form; it shows clearly that you
intend a regexp match. 
</ul>

<!-- fakenode - for prepinfo -->
<h4 class="subheading">Advanced Notes: Using <code>\n</code> in Character Lists of Dynamic Regexps</h4>

<p><a name="index-regular-expressions_002c-dynamic_002c-with-embedded-newlines-338"></a><a name="index-newlines_002c-in-dynamic-regexps-339"></a>
Some commercial versions of <samp><span class="command">awk</span></samp> do not allow the newline
character to be used inside a character list for a dynamic regexp:

<pre class="example">     $ awk '$0 ~ "[ \t\n]"'
     error--&gt; awk: newline in character class [
     error--&gt; ]...
     error--&gt;  source line number 1
     error--&gt;  context is
     error--&gt;          &gt;&gt;&gt;  &lt;&lt;&lt;
</pre>
   <p><a name="index-newlines_002c-in-regexp-constants-340"></a>But a newline in a regexp constant works with no problem:

<pre class="example">     $ awk '$0 ~ /[ \t\n]/'
     here is a sample line
     -| here is a sample line
     <kbd>Ctrl-d</kbd>
</pre>
   <p><samp><span class="command">gawk</span></samp> does not have this problem, and it isn't likely to
occur often in practice, but it's worth noting for future reference. 
<!-- ENDOFRANGE dregexp -->
<!-- ENDOFRANGE regexpd -->
<!-- ENDOFRANGE regexp -->

   </body></html>

