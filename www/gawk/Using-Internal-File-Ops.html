<html lang="en">
<head>
<title>Using Internal File Ops - The GNU Awk User's Guide</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="The GNU Awk User's Guide">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Sample-Library.html#Sample-Library" title="Sample Library">
<link rel="prev" href="Internal-File-Ops.html#Internal-File-Ops" title="Internal File Ops">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
Copyright (C) 1989, 1991, 1992, 1993, 1996, 1997, 1998, 1999,
2000, 2001, 2002, 2003, 2004, 2005, 2007, 2009 Free Software Foundation, Inc.



   This is Edition 3 of `GAWK: Effective AWK Programming: A User's Guide for GNU Awk',
for the 3.1.7 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being ``GNU General Public License'', the Front-Cover
texts being (a) (see below), and with the Back-Cover Texts being (b)
(see below).  A copy of the license is included in the section entitled
``GNU Free Documentation License''.
  a. ``A GNU Manual''

  b. ``You have the freedom to copy and modify this GNU manual.  Buying
     copies from the FSF supports it in developing GNU and promoting
     software freedom.''
        -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Using-Internal-File-Ops"></a>
<p>
Previous:&nbsp;<a rel="previous" accesskey="p" href="Internal-File-Ops.html#Internal-File-Ops">Internal File Ops</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Sample-Library.html#Sample-Library">Sample Library</a>
<hr>
</div>

<h5 class="appendixsubsubsec">C.3.2.3 Integrating the Extensions</h5>

<p><a name="index-g_t_0040command_007bgawk_007d_002c-interpreter_0040comma_007b_007d-adding-code-to-2048"></a>Now that the code is written, it must be possible to add it at
runtime to the running <samp><span class="command">gawk</span></samp> interpreter.  First, the
code must be compiled.  Assuming that the functions are in
a file named <samp><span class="file">filefuncs.c</span></samp>, and <var>idir</var> is the location
of the <samp><span class="command">gawk</span></samp> include files,
the following steps create
a GNU/Linux shared library:

<pre class="example">     $ gcc -shared -DHAVE_CONFIG_H -c -O -g -I<var>idir</var> filefuncs.c
     $ ld -o filefuncs.so -shared filefuncs.o
</pre>
   <p><a name="index-g_t_0040code_007bextension_007d-function-_0028_0040command_007bgawk_007d_0029-2049"></a>Once the library exists, it is loaded by calling the <code>extension</code>
built-in function. 
This function takes two arguments: the name of the
library to load and the name of a function to call when the library
is first loaded. This function adds the new functions to <samp><span class="command">gawk</span></samp>. 
It returns the value returned by the initialization function
within the shared library:

<pre class="example">     # file testff.awk
     BEGIN {
         extension("./filefuncs.so", "dlload")
     
         chdir(".")  # no-op
     
         data[1] = 1 # force `data' to be an array
         print "Info for testff.awk"
         ret = stat("testff.awk", data)
         print "ret =", ret
         for (i in data)
             printf "data[\"%s\"] = %s\n", i, data[i]
         print "testff.awk modified:",
             strftime("%m %d %y %H:%M:%S", data["mtime"])
     }
</pre>
   <p>Here are the results of running the program:

<pre class="example">     $ gawk -f testff.awk
     -| Info for testff.awk
     -| ret = 0
     -| data["blksize"] = 4096
     -| data["mtime"] = 932361936
     -| data["mode"] = 33188
     -| data["type"] = file
     -| data["dev"] = 2065
     -| data["gid"] = 10
     -| data["ino"] = 878597
     -| data["ctime"] = 971431797
     -| data["blocks"] = 2
     -| data["nlink"] = 1
     -| data["name"] = testff.awk
     -| data["atime"] = 971608519
     -| data["pmode"] = -rw-r--r--
     -| data["size"] = 607
     -| data["uid"] = 2076
     -| testff.awk modified: 07 19 99 08:25:36
</pre>
   <!-- ENDOFRANGE filre -->
<!-- ENDOFRANGE dirch -->
<!-- ENDOFRANGE statg -->
<!-- ENDOFRANGE chdirg -->
<!-- ENDOFRANGE gladfgaw -->
<!-- ENDOFRANGE adfugaw -->
<!-- ENDOFRANGE fubadgaw -->
   </body></html>

