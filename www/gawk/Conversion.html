<html lang="en">
<head>
<title>Conversion - The GNU Awk User's Guide</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="The GNU Awk User's Guide">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Expressions.html#Expressions" title="Expressions">
<link rel="prev" href="Variables.html#Variables" title="Variables">
<link rel="next" href="Arithmetic-Ops.html#Arithmetic-Ops" title="Arithmetic Ops">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
Copyright (C) 1989, 1991, 1992, 1993, 1996, 1997, 1998, 1999,
2000, 2001, 2002, 2003, 2004, 2005, 2007, 2009 Free Software Foundation, Inc.



   This is Edition 3 of `GAWK: Effective AWK Programming: A User's Guide for GNU Awk',
for the 3.1.7 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being ``GNU General Public License'', the Front-Cover
texts being (a) (see below), and with the Back-Cover Texts being (b)
(see below).  A copy of the license is included in the section entitled
``GNU Free Documentation License''.
  a. ``A GNU Manual''

  b. ``You have the freedom to copy and modify this GNU manual.  Buying
     copies from the FSF supports it in developing GNU and promoting
     software freedom.''
        -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Conversion"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="Arithmetic-Ops.html#Arithmetic-Ops">Arithmetic Ops</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Variables.html#Variables">Variables</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Expressions.html#Expressions">Expressions</a>
<hr>
</div>

<h3 class="section">5.4 Conversion of Strings and Numbers</h3>

<p><a name="index-converting_002c-strings-to-numbers-645"></a><a name="index-strings_002c-converting-646"></a><a name="index-numbers_002c-converting-647"></a><a name="index-converting_002c-numbers-648"></a>Strings are converted to numbers and numbers are converted to strings, if the context
of the <samp><span class="command">awk</span></samp> program demands it.  For example, if the value of
either <code>foo</code> or <code>bar</code> in the expression &lsquo;<samp><span class="samp">foo + bar</span></samp>&rsquo;
happens to be a string, it is converted to a number before the addition
is performed.  If numeric values appear in string concatenation, they
are converted to strings.  Consider the following:

<pre class="example">     two = 2; three = 3
     print (two three) + 4
</pre>
   <p class="noindent">This prints the (numeric) value 27.  The numeric values of
the variables <code>two</code> and <code>three</code> are converted to strings and
concatenated together.  The resulting string is converted back to the
number 23, to which 4 is then added.

   <p><a name="index-null-strings_002c-converting-numbers-to-strings-649"></a><a name="index-type-conversion-650"></a>If, for some reason, you need to force a number to be converted to a
string, concatenate the empty string, <code>""</code>, with that number. 
To force a string to be converted to a number, add zero to that string. 
A string is converted to a number by interpreting any numeric prefix
of the string as numerals:
<code>"2.5"</code> converts to 2.5, <code>"1e3"</code> converts to 1000, and <code>"25fix"</code>
has a numeric value of 25. 
Strings that can't be interpreted as valid numbers convert to zero.

   <p><a name="index-g_t_0040code_007bCONVFMT_007d-variable-651"></a>The exact manner in which numbers are converted into strings is controlled
by the <samp><span class="command">awk</span></samp> built-in variable <code>CONVFMT</code> (see <a href="Built_002din-Variables.html#Built_002din-Variables">Built-in Variables</a>). 
Numbers are converted using the <code>sprintf</code> function
with <code>CONVFMT</code> as the format
specifier
(see <a href="String-Functions.html#String-Functions">String Functions</a>).

   <p><code>CONVFMT</code>'s default value is <code>"%.6g"</code>, which prints a value with
at most six significant digits.  For some applications, you might want to
change it to specify more precision. 
On most modern machines,
17 digits is enough to capture a floating-point number's
value exactly,
most of the time.<a rel="footnote" href="#fn-1" name="fnd-1"><sup>1</sup></a>

   <p><a name="index-dark-corner_002c-_0040code_007bCONVFMT_007d-variable-652"></a>Strange results can occur if you set <code>CONVFMT</code> to a string that doesn't
tell <code>sprintf</code> how to format floating-point numbers in a useful way. 
For example, if you forget the &lsquo;<samp><span class="samp">%</span></samp>&rsquo; in the format, <samp><span class="command">awk</span></samp> converts
all numbers to the same constant string. 
As a special case, if a number is an integer, then the result of converting
it to a string is <em>always</em> an integer, no matter what the value of
<code>CONVFMT</code> may be.  Given the following code fragment:

<pre class="example">     CONVFMT = "%2.2f"
     a = 12
     b = a ""
</pre>
   <p class="noindent"><code>b</code> has the value <code>"12"</code>, not <code>"12.00"</code>. 
(d.c.)

   <p><a name="index-POSIX-_0040command_007bawk_007d_002c-_0040code_007bOFMT_007d-variable-and-653"></a><a name="index-g_t_0040code_007bOFMT_007d-variable-654"></a><a name="index-portability_002c-new-_0040command_007bawk_007d-vs_002e_0040_003a-old-_0040command_007bawk_007d-655"></a><a name="index-g_t_0040command_007bawk_007d_002c-new-vs_002e_0040_003a-old_002c-_0040code_007bOFMT_007d-variable-656"></a>Prior to the POSIX standard, <samp><span class="command">awk</span></samp> used the value
of <code>OFMT</code> for converting numbers to strings.  <code>OFMT</code>
specifies the output format to use when printing numbers with <code>print</code>. 
<code>CONVFMT</code> was introduced in order to separate the semantics of
conversion from the semantics of printing.  Both <code>CONVFMT</code> and
<code>OFMT</code> have the same default value: <code>"%.6g"</code>.  In the vast majority
of cases, old <samp><span class="command">awk</span></samp> programs do not change their behavior. 
However, these semantics for <code>OFMT</code> are something to keep in mind if you must
port your new style program to older implementations of <samp><span class="command">awk</span></samp>. 
We recommend
that instead of changing your programs, just port <samp><span class="command">gawk</span></samp> itself. 
See <a href="Print.html#Print">Print</a>,
for more information on the <code>print</code> statement.

   <p>And, once again, where you are can matter when it comes to converting
between numbers and strings.  In <a href="Locales.html#Locales">Locales</a>, we mentioned that
the local character set and language (the locale) can affect how
<samp><span class="command">gawk</span></samp> matches characters.  The locale also affects numeric
formats.  In particular, for <samp><span class="command">awk</span></samp> programs, it affects the
decimal point character.  The <code>"C"</code> locale, and most English-language
locales, use the period character (&lsquo;<samp><span class="samp">.</span></samp>&rsquo;) as the decimal point. 
However, many (if not most) European and non-English locales use the comma
(&lsquo;<samp><span class="samp">,</span></samp>&rsquo;) as the decimal point character.

   <p>The POSIX standard says that <samp><span class="command">awk</span></samp> always uses the period as the decimal
point when reading the <samp><span class="command">awk</span></samp> program source code, and for command-line
variable assignments (see <a href="Other-Arguments.html#Other-Arguments">Other Arguments</a>). 
However, when interpreting input data, for <code>print</code> and <code>printf</code> output,
and for number to string conversion, the local decimal point character is used. 
Here are some examples indicating the difference in behavior,
on a GNU/Linux system:

<pre class="example">     $ gawk 'BEGIN { printf "%g\n", 3.1415927 }'
     -| 3.14159
     $  LC_ALL=en_DK gawk 'BEGIN { printf "%g\n", 3.1415927 }'
     -| 3,14159
     $ echo 4,321 | gawk '{ print $1 + 1 }'
     -| 5
     $ echo 4,321 | LC_ALL=en_DK gawk '{ print $1 + 1 }'
     -| 5,321
</pre>
   <p class="noindent">The &lsquo;<samp><span class="samp">en_DK</span></samp>&rsquo; locale is for English in Denmark, where the comma acts as
the decimal point separator.  In the normal <code>"C"</code> locale, <samp><span class="command">gawk</span></samp>
treats &lsquo;<samp><span class="samp">4,321</span></samp>&rsquo; as &lsquo;<samp><span class="samp">4</span></samp>&rsquo;, while in the Danish locale, it's treated
as the full number, &lsquo;<samp><span class="samp">4.321</span></samp>&rsquo;.

   <p>For version 3.1.3 through 3.1.5, <samp><span class="command">gawk</span></samp> fully complied
with this aspect of the standard.  However, many users in non-English
locales complained about this behavior, since their data used a period
as the decimal point.  Beginning in version 3.1.6, the default
behavior was restored to use a period as the decimal point character. 
You can use the <samp><span class="option">--use-lc-numeric</span></samp> option (see <a href="Options.html#Options">Options</a>)
to force <samp><span class="command">gawk</span></samp> to use the locale's decimal point character. 
(<samp><span class="command">gawk</span></samp> also uses the locale's decimal point character when in
POSIX mode, either via <samp><span class="option">--posix</span></samp>, or the <samp><span class="env">POSIXLY_CORRECT</span></samp>
environment variable.)

   <p>The following table describes the cases in which the locale's decimal
point character is used and when a period is used. Some of these
features have not been described yet.

   <div class="float">
<a name="table_002dlocale_002daffects"></a>
   <p><table summary=""><tr align="left"><th valign="top" width="15%">Feature </th><th valign="top" width="20%">Default </th><th valign="top" width="45%"><samp><span class="option">--posix</span></samp> or <samp><span class="option">--use-lc-numeric</span></samp>
<br></th></tr><tr align="left"><td valign="top" width="15%">&lsquo;<samp><span class="samp">%'g</span></samp>&rsquo; </td><td valign="top" width="20%">Use locale </td><td valign="top" width="45%">Use locale
<br></td></tr><tr align="left"><td valign="top" width="15%">&lsquo;<samp><span class="samp">%g</span></samp>&rsquo; </td><td valign="top" width="20%">Use period </td><td valign="top" width="45%">Use locale
<br></td></tr><tr align="left"><td valign="top" width="15%">Input </td><td valign="top" width="20%">Use period </td><td valign="top" width="45%">Use locale
<br></td></tr><tr align="left"><td valign="top" width="15%">&lsquo;<samp><span class="samp">strtonum</span></samp>&rsquo; </td><td valign="top" width="20%">Use period </td><td valign="top" width="45%">Use locale
   <br></td></tr></table>
<p><strong class="float-caption">Table 5.1: Locale Decimal Point versus A Period</strong></p></div>

   <p>Finally, modern day formal standards and IEEE standard floating point
representation can have an unusual but important effect on the way
<samp><span class="command">gawk</span></samp> converts some special string values to numbers.  The details
are presented in <a href="POSIX-Floating-Point-Problems.html#POSIX-Floating-Point-Problems">POSIX Floating Point Problems</a>.

   <div class="footnote">
<hr>
<h4>Footnotes</h4><p class="footnote"><small>[<a name="fn-1" href="#fnd-1">1</a>]</small> Pathological cases can require up to
752 digits (!), but we doubt that you need to worry about this.</p>

   <hr></div>

   </body></html>

