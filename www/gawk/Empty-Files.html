<html lang="en">
<head>
<title>Empty Files - The GNU Awk User's Guide</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="The GNU Awk User's Guide">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Data-File-Management.html#Data-File-Management" title="Data File Management">
<link rel="prev" href="File-Checking.html#File-Checking" title="File Checking">
<link rel="next" href="Ignoring-Assigns.html#Ignoring-Assigns" title="Ignoring Assigns">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
Copyright (C) 1989, 1991, 1992, 1993, 1996, 1997, 1998, 1999,
2000, 2001, 2002, 2003, 2004, 2005, 2007, 2009 Free Software Foundation, Inc.



   This is Edition 3 of `GAWK: Effective AWK Programming: A User's Guide for GNU Awk',
for the 3.1.7 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being ``GNU General Public License'', the Front-Cover
texts being (a) (see below), and with the Back-Cover Texts being (b)
(see below).  A copy of the license is included in the section entitled
``GNU Free Documentation License''.
  a. ``A GNU Manual''

  b. ``You have the freedom to copy and modify this GNU manual.  Buying
     copies from the FSF supports it in developing GNU and promoting
     software freedom.''
        -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Empty-Files"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="Ignoring-Assigns.html#Ignoring-Assigns">Ignoring Assigns</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="File-Checking.html#File-Checking">File Checking</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Data-File-Management.html#Data-File-Management">Data File Management</a>
<hr>
</div>

<h4 class="subsection">12.3.4 Checking For Zero-length Files</h4>

<p>All known <samp><span class="command">awk</span></samp> implementations silently skip over zero-length files. 
This is a by-product of <samp><span class="command">awk</span></samp>'s implicit
read-a-record-and-match-against-the-rules loop: when <samp><span class="command">awk</span></samp>
tries to read a record from an empty file, it immediately receives an
end of file indication, closes the file, and proceeds on to the next
command-line data file, <em>without</em> executing any user-level
<samp><span class="command">awk</span></samp> program code.

   <p>Using <samp><span class="command">gawk</span></samp>'s <code>ARGIND</code> variable
(see <a href="Built_002din-Variables.html#Built_002din-Variables">Built-in Variables</a>), it is possible to detect when an empty
data file has been skipped.  Similar to the library file presented
in <a href="Filetrans-Function.html#Filetrans-Function">Filetrans Function</a>, the following library file calls a function named
<code>zerofile</code> that the user must provide.  The arguments passed are
the file name and the position in <code>ARGV</code> where it was found:

   <p><a name="index-g_t_0040code_007bzerofile_002eawk_007d-program-1691"></a>
<pre class="example">     <!-- file eg/lib/zerofile.awk -->
     # zerofile.awk --- library file to process empty input files
     <!-- endfile -->
     <!-- file eg/lib/zerofile.awk -->
     BEGIN { Argind = 0 }
     
     ARGIND &gt; Argind + 1 {
         for (Argind++; Argind &lt; ARGIND; Argind++)
             zerofile(ARGV[Argind], Argind)
     }
     
     ARGIND != Argind { Argind = ARGIND }
     
     END {
         if (ARGIND &gt; Argind)
             for (Argind++; Argind &lt;= ARGIND; Argind++)
                 zerofile(ARGV[Argind], Argind)
     }
     <!-- endfile -->
</pre>
   <p>The user-level variable <code>Argind</code> allows the <samp><span class="command">awk</span></samp> program
to track its progress through <code>ARGV</code>.  Whenever the program detects
that <code>ARGIND</code> is greater than &lsquo;<samp><span class="samp">Argind + 1</span></samp>&rsquo;, it means that one or
more empty files were skipped.  The action then calls <code>zerofile</code> for
each such file, incrementing <code>Argind</code> along the way.

   <p>The &lsquo;<samp><span class="samp">Argind != ARGIND</span></samp>&rsquo; rule simply keeps <code>Argind</code> up to date
in the normal case.

   <p>Finally, the <code>END</code> rule catches the case of any empty files at
the end of the command-line arguments.  Note that the test in the
condition of the <code>for</code> loop uses the &lsquo;<samp><span class="samp">&lt;=</span></samp>&rsquo; operator,
not <code>&lt;</code>.

   <p>As an exercise, you might consider whether this same problem can
be solved without relying on <samp><span class="command">gawk</span></samp>'s <code>ARGIND</code> variable.

   <p>As a second exercise, revise this code to handle the case where
an intervening value in <code>ARGV</code> is a variable assignment.

   </body></html>

