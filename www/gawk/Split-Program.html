<html lang="en">
<head>
<title>Split Program - The GNU Awk User's Guide</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="The GNU Awk User's Guide">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Clones.html#Clones" title="Clones">
<link rel="prev" href="Id-Program.html#Id-Program" title="Id Program">
<link rel="next" href="Tee-Program.html#Tee-Program" title="Tee Program">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
Copyright (C) 1989, 1991, 1992, 1993, 1996, 1997, 1998, 1999,
2000, 2001, 2002, 2003, 2004, 2005, 2007, 2009 Free Software Foundation, Inc.



   This is Edition 3 of `GAWK: Effective AWK Programming: A User's Guide for GNU Awk',
for the 3.1.7 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being ``GNU General Public License'', the Front-Cover
texts being (a) (see below), and with the Back-Cover Texts being (b)
(see below).  A copy of the license is included in the section entitled
``GNU Free Documentation License''.
  a. ``A GNU Manual''

  b. ``You have the freedom to copy and modify this GNU manual.  Buying
     copies from the FSF supports it in developing GNU and promoting
     software freedom.''
        -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Split-Program"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="Tee-Program.html#Tee-Program">Tee Program</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Id-Program.html#Id-Program">Id Program</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Clones.html#Clones">Clones</a>
<hr>
</div>

<h4 class="subsection">13.2.4 Splitting a Large File into Pieces</h4>

<!-- STARTOFRANGE filspl -->
<p><a name="index-files_002c-splitting-1781"></a><a name="index-g_t_0040code_007bsplit_007d-utility-1782"></a>The <code>split</code> program splits large text files into smaller pieces. 
Usage is as follows:

<pre class="example">     split <span class="roman">[</span>-<var>count</var><span class="roman">]</span> file <span class="roman">[</span> <var>prefix</var> <span class="roman">]</span>
</pre>
   <p>By default,
the output files are named <samp><span class="file">xaa</span></samp>, <samp><span class="file">xab</span></samp>, and so on. Each file has
1000 lines in it, with the likely exception of the last file. To change the
number of lines in each file, supply a number on the command line
preceded with a minus; e.g., &lsquo;<samp><span class="samp">-500</span></samp>&rsquo; for files with 500 lines in them
instead of 1000.  To change the name of the output files to something like
<samp><span class="file">myfileaa</span></samp>, <samp><span class="file">myfileab</span></samp>, and so on, supply an additional
argument that specifies the file name prefix.

   <p>Here is a version of <code>split</code> in <samp><span class="command">awk</span></samp>. It uses the <code>ord</code> and
<code>chr</code> functions presented in
<a href="Ordinal-Functions.html#Ordinal-Functions">Ordinal Functions</a>.

   <p>The program first sets its defaults, and then tests to make sure there are
not too many arguments.  It then looks at each argument in turn.  The
first argument could be a minus sign followed by a number. If it is, this happens
to look like a negative number, so it is made positive, and that is the
count of lines.  The data file name is skipped over and the final argument
is used as the prefix for the output file names:

   <p><a name="index-g_t_0040code_007bsplit_002eawk_007d-program-1783"></a>
<pre class="example">     <!-- file eg/prog/split.awk -->
     # split.awk --- do split in awk
     #
     # Requires ord and chr library functions
     <!-- endfile -->
     <!-- file eg/prog/split.awk -->
     # usage: split [-num] [file] [outname]
     
     BEGIN {
         outfile = "x"    # default
         count = 1000
         if (ARGC &gt; 4)
             usage()
     
         i = 1
         if (ARGV[i] ~ /^-[0-9]+$/) {
             count = -ARGV[i]
             ARGV[i] = ""
             i++
         }
         # test argv in case reading from stdin instead of file
         if (i in ARGV)
             i++    # skip data file name
         if (i in ARGV) {
             outfile = ARGV[i]
             ARGV[i] = ""
         }
     
         s1 = s2 = "a"
         out = (outfile s1 s2)
     }
     <!-- endfile -->
</pre>
   <p>The next rule does most of the work. <code>tcount</code> (temporary count) tracks
how many lines have been printed to the output file so far. If it is greater
than <code>count</code>, it is time to close the current file and start a new one. 
<code>s1</code> and <code>s2</code> track the current suffixes for the file name. If
they are both &lsquo;<samp><span class="samp">z</span></samp>&rsquo;, the file is just too big.  Otherwise, <code>s1</code>
moves to the next letter in the alphabet and <code>s2</code> starts over again at
&lsquo;<samp><span class="samp">a</span></samp>&rsquo;:

<!-- else on separate line here for page breaking -->
<pre class="example">     <!-- file eg/prog/split.awk -->
     {
         if (++tcount &gt; count) {
             close(out)
             if (s2 == "z") {
                 if (s1 == "z") {
                     printf("split: %s is too large to split\n",
                            FILENAME) &gt; "/dev/stderr"
                     exit 1
                 }
                 s1 = chr(ord(s1) + 1)
                 s2 = "a"
             }
             else
                 s2 = chr(ord(s2) + 1)
             out = (outfile s1 s2)
             tcount = 1
         }
         print &gt; out
     }
     <!-- endfile -->
</pre>
   <!-- Exercise: do this with just awk builtin functions, index("abc..."), substr, etc. -->
<p class="noindent">The <code>usage</code> function simply prints an error message and exits:

<pre class="example">     <!-- file eg/prog/split.awk -->
     function usage(   e)
     {
         e = "usage: split [-num] [file] [outname]"
         print e &gt; "/dev/stderr"
         exit 1
     }
     <!-- endfile -->
</pre>
   <p class="noindent">The variable <code>e</code> is used so that the function
fits nicely on the
page.

   <p>This program is a bit sloppy; it relies on <samp><span class="command">awk</span></samp> to automatically close the last file
instead of doing it in an <code>END</code> rule. 
It also assumes that letters are contiguous in the character set,
which isn't true for EBCDIC systems. 
<!-- BFD... -->
<!-- ENDOFRANGE filspl -->

   </body></html>

