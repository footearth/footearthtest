<html lang="en">
<head>
<title>Word Sorting - The GNU Awk User's Guide</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="The GNU Awk User's Guide">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Miscellaneous-Programs.html#Miscellaneous-Programs" title="Miscellaneous Programs">
<link rel="prev" href="Labels-Program.html#Labels-Program" title="Labels Program">
<link rel="next" href="History-Sorting.html#History-Sorting" title="History Sorting">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
Copyright (C) 1989, 1991, 1992, 1993, 1996, 1997, 1998, 1999,
2000, 2001, 2002, 2003, 2004, 2005, 2007, 2009 Free Software Foundation, Inc.



   This is Edition 3 of `GAWK: Effective AWK Programming: A User's Guide for GNU Awk',
for the 3.1.7 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being ``GNU General Public License'', the Front-Cover
texts being (a) (see below), and with the Back-Cover Texts being (b)
(see below).  A copy of the license is included in the section entitled
``GNU Free Documentation License''.
  a. ``A GNU Manual''

  b. ``You have the freedom to copy and modify this GNU manual.  Buying
     copies from the FSF supports it in developing GNU and promoting
     software freedom.''
        -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Word-Sorting"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="History-Sorting.html#History-Sorting">History Sorting</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Labels-Program.html#Labels-Program">Labels Program</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Miscellaneous-Programs.html#Miscellaneous-Programs">Miscellaneous Programs</a>
<hr>
</div>

<h4 class="subsection">13.3.5 Generating Word-Usage Counts</h4>

<!-- STARTOFRANGE worus -->
<p><a name="index-words_002c-usage-counts_0040comma_007b_007d-generating-1817"></a><!-- NEXT ED: Rewrite this whole section and example -->
The following <samp><span class="command">awk</span></samp> program prints
the number of occurrences of each word in its input.  It illustrates the
associative nature of <samp><span class="command">awk</span></samp> arrays by using strings as subscripts.  It
also demonstrates the &lsquo;<samp><span class="samp">for </span><var>index</var><span class="samp"> in </span><var>array</var></samp>&rsquo; mechanism. 
Finally, it shows how <samp><span class="command">awk</span></samp> is used in conjunction with other
utility programs to do a useful task of some complexity with a minimum of
effort.  Some explanations follow the program listing:

<pre class="example">     # Print list of word frequencies
     {
         for (i = 1; i &lt;= NF; i++)
             freq[$i]++
     }
     
     END {
         for (word in freq)
             printf "%s\t%d\n", word, freq[word]
     }
</pre>
   <!-- Exercise: Use asort() here -->
   <p>This program has two rules.  The
first rule, because it has an empty pattern, is executed for every input line. 
It uses <samp><span class="command">awk</span></samp>'s field-accessing mechanism
(see <a href="Fields.html#Fields">Fields</a>) to pick out the individual words from
the line, and the built-in variable <code>NF</code> (see <a href="Built_002din-Variables.html#Built_002din-Variables">Built-in Variables</a>)
to know how many fields are available. 
For each input word, it increments an element of the array <code>freq</code> to
reflect that the word has been seen an additional time.

   <p>The second rule, because it has the pattern <code>END</code>, is not executed
until the input has been exhausted.  It prints out the contents of the
<code>freq</code> table that has been built up inside the first action. 
This program has several problems that would prevent it from being
useful by itself on real text files:

     <ul>
<li>Words are detected using the <samp><span class="command">awk</span></samp> convention that fields are
separated just by whitespace.  Other characters in the input (except
newlines) don't have any special meaning to <samp><span class="command">awk</span></samp>.  This means that
punctuation characters count as part of words.

     <li>The <samp><span class="command">awk</span></samp> language considers upper- and lowercase characters to be
distinct.  Therefore, &ldquo;bartender&rdquo; and &ldquo;Bartender&rdquo; are not treated
as the same word.  This is undesirable, since in normal text, words
are capitalized if they begin sentences, and a frequency analyzer should not
be sensitive to capitalization.

     <li>The output does not come out in any useful order.  You're more likely to be
interested in which words occur most frequently or in having an alphabetized
table of how frequently each word occurs. 
</ul>

   <p><a name="index-g_t_0040command_007bsort_007d-utility-1818"></a>The way to solve these problems is to use some of <samp><span class="command">awk</span></samp>'s more advanced
features.  First, we use <code>tolower</code> to remove
case distinctions.  Next, we use <code>gsub</code> to remove punctuation
characters.  Finally, we use the system <samp><span class="command">sort</span></samp> utility to process the
output of the <samp><span class="command">awk</span></samp> script.  Here is the new version of
the program:

   <p><a name="index-g_t_0040code_007bwordfreq_002eawk_007d-program-1819"></a>
<pre class="example">     <!-- file eg/prog/wordfreq.awk -->
     # wordfreq.awk --- print list of word frequencies
     
     {
         $0 = tolower($0)    # remove case distinctions
         # remove punctuation
         gsub(/[^[:alnum:]_[:blank:]]/, "", $0)
         for (i = 1; i &lt;= NF; i++)
             freq[$i]++
     }
     
     END {
         for (word in freq)
             printf "%s\t%d\n", word, freq[word]
     }
     <!-- endfile -->
</pre>
   <p>Assuming we have saved this program in a file named <samp><span class="file">wordfreq.awk</span></samp>,
and that the data is in <samp><span class="file">file1</span></samp>, the following pipeline:

<pre class="example">     awk -f wordfreq.awk file1 | sort -k 2nr
</pre>
   <p class="noindent">produces a table of the words appearing in <samp><span class="file">file1</span></samp> in order of
decreasing frequency.  The <samp><span class="command">awk</span></samp> program suitably massages the
data and produces a word frequency table, which is not ordered.

   <p>The <samp><span class="command">awk</span></samp> script's output is then sorted by the <samp><span class="command">sort</span></samp>
utility and printed on the terminal.  The options given to <samp><span class="command">sort</span></samp>
specify a sort that uses the second field of each input line (skipping
one field), that the sort keys should be treated as numeric quantities
(otherwise &lsquo;<samp><span class="samp">15</span></samp>&rsquo; would come before &lsquo;<samp><span class="samp">5</span></samp>&rsquo;), and that the sorting
should be done in descending (reverse) order.

   <p>The <samp><span class="command">sort</span></samp> could even be done from within the program, by changing
the <code>END</code> action to:

<pre class="example">     <!-- file eg/prog/wordfreq.awk -->
     END {
         sort = "sort -k 2nr"
         for (word in freq)
             printf "%s\t%d\n", word, freq[word] | sort
         close(sort)
     }
     <!-- endfile -->
</pre>
   <p>This way of sorting must be used on systems that do not
have true pipes at the command-line (or batch-file) level. 
See the general operating system documentation for more information on how
to use the <samp><span class="command">sort</span></samp> program. 
<!-- ENDOFRANGE worus -->

   </body></html>

