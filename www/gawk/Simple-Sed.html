<html lang="en">
<head>
<title>Simple Sed - The GNU Awk User's Guide</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="The GNU Awk User's Guide">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Miscellaneous-Programs.html#Miscellaneous-Programs" title="Miscellaneous Programs">
<link rel="prev" href="Extract-Program.html#Extract-Program" title="Extract Program">
<link rel="next" href="Igawk-Program.html#Igawk-Program" title="Igawk Program">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
Copyright (C) 1989, 1991, 1992, 1993, 1996, 1997, 1998, 1999,
2000, 2001, 2002, 2003, 2004, 2005, 2007, 2009 Free Software Foundation, Inc.



   This is Edition 3 of `GAWK: Effective AWK Programming: A User's Guide for GNU Awk',
for the 3.1.7 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being ``GNU General Public License'', the Front-Cover
texts being (a) (see below), and with the Back-Cover Texts being (b)
(see below).  A copy of the license is included in the section entitled
``GNU Free Documentation License''.
  a. ``A GNU Manual''

  b. ``You have the freedom to copy and modify this GNU manual.  Buying
     copies from the FSF supports it in developing GNU and promoting
     software freedom.''
        -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Simple-Sed"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="Igawk-Program.html#Igawk-Program">Igawk Program</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Extract-Program.html#Extract-Program">Extract Program</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Miscellaneous-Programs.html#Miscellaneous-Programs">Miscellaneous Programs</a>
<hr>
</div>

<h4 class="subsection">13.3.8 A Simple Stream Editor</h4>

<p><a name="index-g_t_0040command_007bsed_007d-utility-1827"></a><a name="index-stream-editors-1828"></a>The <samp><span class="command">sed</span></samp> utility is a stream editor, a program that reads a
stream of data, makes changes to it, and passes it on. 
It is often used to make global changes to a large file or to a stream
of data generated by a pipeline of commands. 
While <samp><span class="command">sed</span></samp> is a complicated program in its own right, its most common
use is to perform global substitutions in the middle of a pipeline:

<pre class="example">     command1 &lt; orig.data | sed 's/old/new/g' | command2 &gt; result
</pre>
   <p>Here, &lsquo;<samp><span class="samp">s/old/new/g</span></samp>&rsquo; tells <samp><span class="command">sed</span></samp> to look for the regexp
&lsquo;<samp><span class="samp">old</span></samp>&rsquo; on each input line and globally replace it with the text
&lsquo;<samp><span class="samp">new</span></samp>&rsquo;, i.e., all the occurrences on a line.  This is similar to
<samp><span class="command">awk</span></samp>'s <code>gsub</code> function
(see <a href="String-Functions.html#String-Functions">String Functions</a>).

   <p>The following program, <samp><span class="file">awksed.awk</span></samp>, accepts at least two command-line
arguments: the pattern to look for and the text to replace it with. Any
additional arguments are treated as data file names to process. If none
are provided, the standard input is used:

   <p><a name="index-Brennan_002c-Michael-1829"></a><a name="index-g_t_0040command_007bawksed_002eawk_007d-program-1830"></a><!-- @cindex simple stream editor -->
<!-- @cindex stream editor, simple -->
<pre class="example">     <!-- file eg/prog/awksed.awk -->
     # awksed.awk --- do s/foo/bar/g using just print
     #    Thanks to Michael Brennan for the idea
     <!-- endfile -->
     <!-- file eg/prog/awksed.awk -->
     function usage()
     {
         print "usage: awksed pat repl [files...]" &gt; "/dev/stderr"
         exit 1
     }
     
     BEGIN {
         # validate arguments
         if (ARGC &lt; 3)
             usage()
     
         RS = ARGV[1]
         ORS = ARGV[2]
     
         # don't use arguments as files
         ARGV[1] = ARGV[2] = ""
     }
     
     # look ma, no hands!
     {
         if (RT == "")
             printf "%s", $0
         else
             print
     }
     <!-- endfile -->
</pre>
   <p>The program relies on <samp><span class="command">gawk</span></samp>'s ability to have <code>RS</code> be a regexp,
as well as on the setting of <code>RT</code> to the actual text that terminates the
record (see <a href="Records.html#Records">Records</a>).

   <p>The idea is to have <code>RS</code> be the pattern to look for. <samp><span class="command">gawk</span></samp>
automatically sets <code>$0</code> to the text between matches of the pattern. 
This is text that we want to keep, unmodified.  Then, by setting <code>ORS</code>
to the replacement text, a simple <code>print</code> statement outputs the
text we want to keep, followed by the replacement text.

   <p>There is one wrinkle to this scheme, which is what to do if the last record
doesn't end with text that matches <code>RS</code>.  Using a <code>print</code>
statement unconditionally prints the replacement text, which is not correct. 
However, if the file did not end in text that matches <code>RS</code>, <code>RT</code>
is set to the null string.  In this case, we can print <code>$0</code> using
<code>printf</code>
(see <a href="Printf.html#Printf">Printf</a>).

   <p>The <code>BEGIN</code> rule handles the setup, checking for the right number
of arguments and calling <code>usage</code> if there is a problem. Then it sets
<code>RS</code> and <code>ORS</code> from the command-line arguments and sets
<code>ARGV[1]</code> and <code>ARGV[2]</code> to the null string, so that they are
not treated as file names
(see <a href="ARGC-and-ARGV.html#ARGC-and-ARGV">ARGC and ARGV</a>).

   <p>The <code>usage</code> function prints an error message and exits. 
Finally, the single rule handles the printing scheme outlined above,
using <code>print</code> or <code>printf</code> as appropriate, depending upon the
value of <code>RT</code>.

   </body></html>

