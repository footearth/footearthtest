<html lang="en">
<head>
<title>Profiling - The GNU Awk User's Guide</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="The GNU Awk User's Guide">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Advanced-Features.html#Advanced-Features" title="Advanced Features">
<link rel="prev" href="Portal-Files.html#Portal-Files" title="Portal Files">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
Copyright (C) 1989, 1991, 1992, 1993, 1996, 1997, 1998, 1999,
2000, 2001, 2002, 2003, 2004, 2005, 2007, 2009 Free Software Foundation, Inc.



   This is Edition 3 of `GAWK: Effective AWK Programming: A User's Guide for GNU Awk',
for the 3.1.7 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being ``GNU General Public License'', the Front-Cover
texts being (a) (see below), and with the Back-Cover Texts being (b)
(see below).  A copy of the license is included in the section entitled
``GNU Free Documentation License''.
  a. ``A GNU Manual''

  b. ``You have the freedom to copy and modify this GNU manual.  Buying
     copies from the FSF supports it in developing GNU and promoting
     software freedom.''
        -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Profiling"></a>
<p>
Previous:&nbsp;<a rel="previous" accesskey="p" href="Portal-Files.html#Portal-Files">Portal Files</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Advanced-Features.html#Advanced-Features">Advanced Features</a>
<hr>
</div>

<h3 class="section">10.5 Profiling Your <samp><span class="command">awk</span></samp> Programs</h3>

<!-- STARTOFRANGE awkp -->
<p><a name="index-g_t_0040command_007bawk_007d-programs_002c-profiling-1443"></a><!-- STARTOFRANGE proawk -->
<a name="index-profiling-_0040command_007bawk_007d-programs-1444"></a><!-- STARTOFRANGE pgawk -->
<a name="index-g_t_0040command_007bpgawk_007d-program-1445"></a><a name="index-profiling-_0040command_007bgawk_007d_002c-See-_0040command_007bpgawk_007d-program-1446"></a>
Beginning with version 3.1 of <samp><span class="command">gawk</span></samp>, you may produce execution
traces of your <samp><span class="command">awk</span></samp> programs. 
This is done with a specially compiled version of <samp><span class="command">gawk</span></samp>,
called <samp><span class="command">pgawk</span></samp> (&ldquo;profiling <samp><span class="command">gawk</span></samp>&rdquo;).

   <p><a name="index-g_t_0040code_007bawkprof_002eout_007d-file-1447"></a><a name="index-files_002c-_0040code_007bawkprof_002eout_007d-1448"></a><a name="index-g_t_0040command_007bpgawk_007d-program_002c-_0040code_007bawkprof_002eout_007d-file-1449"></a><samp><span class="command">pgawk</span></samp> is identical in every way to <samp><span class="command">gawk</span></samp>, except that when
it has finished running, it creates a profile of your program in a file
named <samp><span class="file">awkprof.out</span></samp>. 
Because it is profiling, it also executes up to 45% slower than
<samp><span class="command">gawk</span></samp> normally does.

   <p><a name="index-g_t_0040code_007b_002d_002dprofile_007d-option-1450"></a>As shown in the following example,
the <samp><span class="option">--profile</span></samp> option can be used to change the name of the file
where <samp><span class="command">pgawk</span></samp> will write the profile:

<pre class="example">     $ pgawk --profile=myprog.prof -f myprog.awk data1 data2
</pre>
   <p class="noindent">In the above example, <samp><span class="command">pgawk</span></samp> places the profile in
<samp><span class="file">myprog.prof</span></samp> instead of in <samp><span class="file">awkprof.out</span></samp>.

   <p>Regular <samp><span class="command">gawk</span></samp> also accepts this option.  When called with just
<samp><span class="option">--profile</span></samp>, <samp><span class="command">gawk</span></samp> &ldquo;pretty prints&rdquo; the program into
<samp><span class="file">awkprof.out</span></samp>, without any execution counts.  You may supply an
option to <samp><span class="option">--profile</span></samp> to change the file name.  Here is a sample
session showing a simple <samp><span class="command">awk</span></samp> program, its input data, and the
results from running <samp><span class="command">pgawk</span></samp>.  First, the <samp><span class="command">awk</span></samp> program:

<pre class="example">     BEGIN { print "First BEGIN rule" }
     
     END { print "First END rule" }
     
     /foo/ {
         print "matched /foo/, gosh"
         for (i = 1; i &lt;= 3; i++)
             sing()
     }
     
     {
         if (/foo/)
             print "if is true"
         else
             print "else is true"
     }
     
     BEGIN { print "Second BEGIN rule" }
     
     END { print "Second END rule" }
     
     function sing(    dummy)
     {
         print "I gotta be me!"
     }
</pre>
   <p>Following is the input data:

<pre class="example">     foo
     bar
     baz
     foo
     junk
</pre>
   <p>Here is the <samp><span class="file">awkprof.out</span></samp> that results from running <samp><span class="command">pgawk</span></samp>
on this program and data (this example also illustrates that <samp><span class="command">awk</span></samp>
programmers sometimes have to work late):

   <p><a name="index-g_t_0040code_007bBEGIN_007d-pattern_002c-_0040command_007bpgawk_007d-program-1451"></a><a name="index-g_t_0040code_007bEND_007d-pattern_002c-_0040command_007bpgawk_007d-program-1452"></a>
<pre class="example">             # gawk profile, created Sun Aug 13 00:00:15 2000
     
             # BEGIN block(s)
     
             BEGIN {
          1          print "First BEGIN rule"
          1          print "Second BEGIN rule"
             }
     
             # Rule(s)
     
          5  /foo/   { # 2
          2          print "matched /foo/, gosh"
          6          for (i = 1; i &lt;= 3; i++) {
          6                  sing()
                     }
             }
     
          5  {
          5          if (/foo/) { # 2
          2                  print "if is true"
          3          } else {
          3                  print "else is true"
                     }
             }
     
             # END block(s)
     
             END {
          1          print "First END rule"
          1          print "Second END rule"
             }
     
             # Functions, listed alphabetically
     
          6  function sing(dummy)
             {
          6          print "I gotta be me!"
             }
</pre>
   <p>This example illustrates many of the basic rules for profiling output. 
The rules are as follows:

     <ul>
<li>The program is printed in the order <code>BEGIN</code> rule,
pattern/action rules, <code>END</code> rule and functions, listed
alphabetically. 
Multiple <code>BEGIN</code> and <code>END</code> rules are merged together.

     <p><a name="index-patterns_002c-counts-1453"></a><li>Pattern-action rules have two counts. 
The first count, to the left of the rule, shows how many times
the rule's pattern was <em>tested</em>. 
The second count, to the right of the rule's opening left brace
in a comment,
shows how many times the rule's action was <em>executed</em>. 
The difference between the two indicates how many times the rule's
pattern evaluated to false.

     <li>Similarly,
the count for an <code>if</code>-<code>else</code> statement shows how many times
the condition was tested. 
To the right of the opening left brace for the <code>if</code>'s body
is a count showing how many times the condition was true. 
The count for the <code>else</code>
indicates how many times the test failed.

     <p><a name="index-loops_002c-count-for-header-1454"></a><li>The count for a loop header (such as <code>for</code>
or <code>while</code>) shows how many times the loop test was executed. 
(Because of this, you can't just look at the count on the first
statement in a rule to determine how many times the rule was executed. 
If the first statement is a loop, the count is misleading.)

     <p><a name="index-functions_002c-user_002ddefined_002c-counts-1455"></a><a name="index-user_002ddefined_002c-functions_002c-counts-1456"></a><li>For user-defined functions, the count next to the <code>function</code>
keyword indicates how many times the function was called. 
The counts next to the statements in the body show how many times
those statements were executed.

     <p><a name="index-g_t_0040code_007b_0040_007b_0040_007d_007d-_0028braces_0029_002c-_0040command_007bpgawk_007d-program-1457"></a><a name="index-braces-_0028_0040code_007b_0040_007b_0040_007d_007d_0029_002c-_0040command_007bpgawk_007d-program-1458"></a><li>The layout uses &ldquo;K&amp;R&rdquo; style with TABs. 
Braces are used everywhere, even when
the body of an <code>if</code>, <code>else</code>, or loop is only a single statement.

     <p><a name="index-g_t_0040code_007b_0028_0029_007d-_0028parentheses_0029_002c-_0040command_007bpgawk_007d-program-1459"></a><a name="index-parentheses-_0040code_007b_0028_0029_007d_002c-_0040command_007bpgawk_007d-program-1460"></a><li>Parentheses are used only where needed, as indicated by the structure
of the program and the precedence rules. 
<!-- extra verbiage here satisfies the copyeditor. ugh. -->
For example, &lsquo;<samp><span class="samp">(3 + 5) * 4</span></samp>&rsquo; means add three plus five, then multiply
the total by four.  However, &lsquo;<samp><span class="samp">3 + 5 * 4</span></samp>&rsquo; has no parentheses, and
means &lsquo;<samp><span class="samp">3 + (5 * 4)</span></samp>&rsquo;.

     <li>Parentheses are used around the arguments to <code>print</code>
and <code>printf</code> only when
the <code>print</code> or <code>printf</code> statement is followed by a redirection. 
Similarly, if
the target of a redirection isn't a scalar, it gets parenthesized.

     <li><samp><span class="command">pgawk</span></samp> supplies leading comments in
front of the <code>BEGIN</code> and <code>END</code> rules,
the pattern/action rules, and the functions.

   </ul>

   <p>The profiled version of your program may not look exactly like what you
typed when you wrote it.  This is because <samp><span class="command">pgawk</span></samp> creates the
profiled version by &ldquo;pretty printing&rdquo; its internal representation of
the program.  The advantage to this is that <samp><span class="command">pgawk</span></samp> can produce
a standard representation.  The disadvantage is that all source-code
comments are lost, as are the distinctions among multiple <code>BEGIN</code>
and <code>END</code> rules.  Also, things such as:

<pre class="example">     /foo/
</pre>
   <p class="noindent">come out as:

<pre class="example">     /foo/   {
         print $0
     }
</pre>
   <p class="noindent">which is correct, but possibly surprising.

   <p><a name="index-profiling-_0040command_007bawk_007d-programs_002c-dynamically-1461"></a><a name="index-g_t_0040command_007bpgawk_007d-program_002c-dynamic-profiling-1462"></a>Besides creating profiles when a program has completed,
<samp><span class="command">pgawk</span></samp> can produce a profile while it is running. 
This is useful if your <samp><span class="command">awk</span></samp> program goes into an
infinite loop and you want to see what has been executed. 
To use this feature, run <samp><span class="command">pgawk</span></samp> in the background:

<pre class="example">     $ pgawk -f myprog &amp;
     [1] 13992
</pre>
   <p><a name="index-g_t_0040command_007bkill_007d-command_0040comma_007b_007d-dynamic-profiling-1463"></a><a name="index-g_t_0040code_007bUSR1_007d-signal-1464"></a><a name="index-signals_002c-_0040code_007bUSR1_007d_002f_0040code_007bSIGUSR1_007d-1465"></a>The shell prints a job number and process ID number; in this case, 13992. 
Use the <samp><span class="command">kill</span></samp> command to send the <code>USR1</code> signal
to <samp><span class="command">pgawk</span></samp>:

<pre class="example">     $ kill -USR1 13992
</pre>
   <p class="noindent">As usual, the profiled version of the program is written to
<samp><span class="file">awkprof.out</span></samp>, or to a different file if you use the <samp><span class="option">--profile</span></samp>
option.

   <p>Along with the regular profile, as shown earlier, the profile
includes a trace of any active functions:

<pre class="example">     # Function Call Stack:
     
     #   3. baz
     #   2. bar
     #   1. foo
     # -- main --
</pre>
   <p>You may send <samp><span class="command">pgawk</span></samp> the <code>USR1</code> signal as many times as you like. 
Each time, the profile and function call trace are appended to the output
profile file.

   <p><a name="index-g_t_0040code_007bHUP_007d-signal-1466"></a><a name="index-signals_002c-_0040code_007bHUP_007d_002f_0040code_007bSIGHUP_007d-1467"></a>If you use the <code>HUP</code> signal instead of the <code>USR1</code> signal,
<samp><span class="command">pgawk</span></samp> produces the profile and the function call trace and then exits.

   <p><a name="index-g_t_0040code_007bINT_007d-signal-_0028MS_002dDOS_0029-1468"></a><a name="index-signals_002c-_0040code_007bINT_007d_002f_0040code_007bSIGINT_007d-_0028MS_002dDOS_0029-1469"></a><a name="index-g_t_0040code_007bQUIT_007d-signal-_0028MS_002dDOS_0029-1470"></a><a name="index-signals_002c-_0040code_007bQUIT_007d_002f_0040code_007bSIGQUIT_007d-_0028MS_002dDOS_0029-1471"></a>When <samp><span class="command">pgawk</span></samp> runs on MS-DOS or MS-Windows, it uses the
<code>INT</code> and <code>QUIT</code> signals for producing the profile and, in
the case of the <code>INT</code> signal, <samp><span class="command">pgawk</span></samp> exits.  This is
because these systems don't support the <samp><span class="command">kill</span></samp> command, so the
only signals you can deliver to a program are those generated by the
keyboard.  The <code>INT</code> signal is generated by the
<kbd>Ctrl-&lt;C&gt;</kbd> or <kbd>Ctrl-&lt;BREAK&gt;</kbd> key, while the
<code>QUIT</code> signal is generated by the <kbd>Ctrl-&lt;\&gt;</kbd> key. 
<!-- ENDOFRANGE advgaw -->
<!-- ENDOFRANGE gawadv -->
<!-- ENDOFRANGE pgawk -->
<!-- ENDOFRANGE awkp -->
<!-- ENDOFRANGE proawk -->

   </body></html>

