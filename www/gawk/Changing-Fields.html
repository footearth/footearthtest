<html lang="en">
<head>
<title>Changing Fields - The GNU Awk User's Guide</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="The GNU Awk User's Guide">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Reading-Files.html#Reading-Files" title="Reading Files">
<link rel="prev" href="Nonconstant-Fields.html#Nonconstant-Fields" title="Nonconstant Fields">
<link rel="next" href="Field-Separators.html#Field-Separators" title="Field Separators">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
Copyright (C) 1989, 1991, 1992, 1993, 1996, 1997, 1998, 1999,
2000, 2001, 2002, 2003, 2004, 2005, 2007, 2009 Free Software Foundation, Inc.



   This is Edition 3 of `GAWK: Effective AWK Programming: A User's Guide for GNU Awk',
for the 3.1.7 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being ``GNU General Public License'', the Front-Cover
texts being (a) (see below), and with the Back-Cover Texts being (b)
(see below).  A copy of the license is included in the section entitled
``GNU Free Documentation License''.
  a. ``A GNU Manual''

  b. ``You have the freedom to copy and modify this GNU manual.  Buying
     copies from the FSF supports it in developing GNU and promoting
     software freedom.''
        -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Changing-Fields"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="Field-Separators.html#Field-Separators">Field Separators</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Nonconstant-Fields.html#Nonconstant-Fields">Nonconstant Fields</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Reading-Files.html#Reading-Files">Reading Files</a>
<hr>
</div>

<h3 class="section">3.4 Changing the Contents of a Field</h3>

<!-- STARTOFRANGE ficon -->
<p><a name="index-fields_002c-changing-contents-of-392"></a>The contents of a field, as seen by <samp><span class="command">awk</span></samp>, can be changed within an
<samp><span class="command">awk</span></samp> program; this changes what <samp><span class="command">awk</span></samp> perceives as the
current input record.  (The actual input is untouched; <samp><span class="command">awk</span></samp> <em>never</em>
modifies the input file.) 
Consider the following example and its output:

<pre class="example">     $ awk '{ nboxes = $3 ; $3 = $3 - 10
     &gt;        print nboxes, $3 }' inventory-shipped
     -| 25 15
     -| 32 22
     -| 24 14
     ...
</pre>
   <p class="noindent">The program first saves the original value of field three in the variable
<code>nboxes</code>. 
The &lsquo;<samp><span class="samp">-</span></samp>&rsquo; sign represents subtraction, so this program reassigns
field three, <code>$3</code>, as the original value of field three minus ten:
&lsquo;<samp><span class="samp">$3 - 10</span></samp>&rsquo;.  (See <a href="Arithmetic-Ops.html#Arithmetic-Ops">Arithmetic Ops</a>.) 
Then it prints the original and new values for field three. 
(Someone in the warehouse made a consistent mistake while inventorying
the red boxes.)

   <p>For this to work, the text in field <code>$3</code> must make sense
as a number; the string of characters must be converted to a number
for the computer to do arithmetic on it.  The number resulting
from the subtraction is converted back to a string of characters that
then becomes field three. 
See <a href="Conversion.html#Conversion">Conversion</a>.

   <p>When the value of a field is changed (as perceived by <samp><span class="command">awk</span></samp>), the
text of the input record is recalculated to contain the new field where
the old one was.  In other words, <code>$0</code> changes to reflect the altered
field.  Thus, this program
prints a copy of the input file, with 10 subtracted from the second
field of each line:

<pre class="example">     $ awk '{ $2 = $2 - 10; print $0 }' inventory-shipped
     -| Jan 3 25 15 115
     -| Feb 5 32 24 226
     -| Mar 5 24 34 228
     ...
</pre>
   <p>It is also possible to also assign contents to fields that are out
of range.  For example:

<pre class="example">     $ awk '{ $6 = ($5 + $4 + $3 + $2)
     &gt;        print $6 }' inventory-shipped
     -| 168
     -| 297
     -| 301
     ...
</pre>
   <p><a name="index-adding_002c-fields-393"></a><a name="index-fields_002c-adding-394"></a>We've just created <code>$6</code>, whose value is the sum of fields
<code>$2</code>, <code>$3</code>, <code>$4</code>, and <code>$5</code>.  The &lsquo;<samp><span class="samp">+</span></samp>&rsquo; sign
represents addition.  For the file <samp><span class="file">inventory-shipped</span></samp>, <code>$6</code>
represents the total number of parcels shipped for a particular month.

   <p>Creating a new field changes <samp><span class="command">awk</span></samp>'s internal copy of the current
input record, which is the value of <code>$0</code>.  Thus, if you do &lsquo;<samp><span class="samp">print $0</span></samp>&rsquo;
after adding a field, the record printed includes the new field, with
the appropriate number of field separators between it and the previously
existing fields.

   <p><a name="index-g_t_0040code_007bOFS_007d-variable-395"></a><a name="index-output-field-separator_002c-See-_0040code_007bOFS_007d-variable-396"></a><a name="index-field-separators_002c-See-Also-_0040code_007bOFS_007d-397"></a>This recomputation affects and is affected by
<code>NF</code> (the number of fields; see <a href="Fields.html#Fields">Fields</a>). 
For example, the value of <code>NF</code> is set to the number of the highest
field you create. 
The exact format of <code>$0</code> is also affected by a feature that has not been discussed yet:
the <dfn>output field separator</dfn>, <code>OFS</code>,
used to separate the fields (see <a href="Output-Separators.html#Output-Separators">Output Separators</a>).

   <p>Note, however, that merely <em>referencing</em> an out-of-range field
does <em>not</em> change the value of either <code>$0</code> or <code>NF</code>. 
Referencing an out-of-range field only produces an empty string.  For
example:

<pre class="example">     if ($(NF+1) != "")
         print "can't happen"
     else
         print "everything is normal"
</pre>
   <p class="noindent">should print &lsquo;<samp><span class="samp">everything is normal</span></samp>&rsquo;, because <code>NF+1</code> is certain
to be out of range.  (See <a href="If-Statement.html#If-Statement">If Statement</a>,
for more information about <samp><span class="command">awk</span></samp>'s <code>if-else</code> statements. 
See <a href="Typing-and-Comparison.html#Typing-and-Comparison">Typing and Comparison</a>,
for more information about the &lsquo;<samp><span class="samp">!=</span></samp>&rsquo; operator.)

   <p>It is important to note that making an assignment to an existing field
changes the
value of <code>$0</code> but does not change the value of <code>NF</code>,
even when you assign the empty string to a field.  For example:

<pre class="example">     $ echo a b c d | awk '{ OFS = ":"; $2 = ""
     &gt;                       print $0; print NF }'
     -| a::c:d
     -| 4
</pre>
   <p class="noindent">The field is still there; it just has an empty value, denoted by
the two colons between &lsquo;<samp><span class="samp">a</span></samp>&rsquo; and &lsquo;<samp><span class="samp">c</span></samp>&rsquo;. 
This example shows what happens if you create a new field:

<pre class="example">     $ echo a b c d | awk '{ OFS = ":"; $2 = ""; $6 = "new"
     &gt;                       print $0; print NF }'
     -| a::c:d::new
     -| 6
</pre>
   <p class="noindent">The intervening field, <code>$5</code>, is created with an empty value
(indicated by the second pair of adjacent colons),
and <code>NF</code> is updated with the value six.

<!-- FIXME: Verify that this is in POSIX -->
   <p><a name="index-dark-corner_002c-_0040code_007bNF_007d-variable_002c-decrementing-398"></a><a name="index-g_t_0040code_007bNF_007d-variable_002c-decrementing-399"></a>Decrementing <code>NF</code> throws away the values of the fields
after the new value of <code>NF</code> and recomputes <code>$0</code>. 
(d.c.) 
Here is an example:

<pre class="example">     $ echo a b c d e f | awk '{ print "NF =", NF;
     &gt;                            NF = 3; print $0 }'
     -| NF = 6
     -| a b c
</pre>
   <p><a name="index-portability_002c-_0040code_007bNF_007d-variable_0040comma_007b_007d-decrementing-400"></a><strong>Caution:</strong> Some versions of <samp><span class="command">awk</span></samp> don't
rebuild <code>$0</code> when <code>NF</code> is decremented. Caveat emptor.

   <p>Finally, there are times when it is convenient to force
<samp><span class="command">awk</span></samp> to rebuild the entire record, using the current
value of the fields and <code>OFS</code>.  To do this, use the
seemingly innocuous assignment:

<pre class="example">     $1 = $1   # force record to be reconstituted
     print $0  # or whatever else with $0
</pre>
   <p class="noindent">This forces <samp><span class="command">awk</span></samp> rebuild the record.  It does help
to add a comment, as we've shown here.

   <p>There is a flip side to the relationship between <code>$0</code> and
the fields.  Any assignment to <code>$0</code> causes the record to be
reparsed into fields using the <em>current</em> value of <code>FS</code>. 
This also applies to any built-in function that updates <code>$0</code>,
such as <code>sub</code> and <code>gsub</code>
(see <a href="String-Functions.html#String-Functions">String Functions</a>). 
<!-- ENDOFRANGE ficon -->

   </body></html>

