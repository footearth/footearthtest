<html lang="en">
<head>
<title>PC Compiling - The GNU Awk User's Guide</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="The GNU Awk User's Guide">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="PC-Installation.html#PC-Installation" title="PC Installation">
<link rel="prev" href="PC-Binary-Installation.html#PC-Binary-Installation" title="PC Binary Installation">
<link rel="next" href="PC-Dynamic.html#PC-Dynamic" title="PC Dynamic">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
Copyright (C) 1989, 1991, 1992, 1993, 1996, 1997, 1998, 1999,
2000, 2001, 2002, 2003, 2004, 2005, 2007, 2009 Free Software Foundation, Inc.



   This is Edition 3 of `GAWK: Effective AWK Programming: A User's Guide for GNU Awk',
for the 3.1.7 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being ``GNU General Public License'', the Front-Cover
texts being (a) (see below), and with the Back-Cover Texts being (b)
(see below).  A copy of the license is included in the section entitled
``GNU Free Documentation License''.
  a. ``A GNU Manual''

  b. ``You have the freedom to copy and modify this GNU manual.  Buying
     copies from the FSF supports it in developing GNU and promoting
     software freedom.''
        -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="PC-Compiling"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="PC-Dynamic.html#PC-Dynamic">PC Dynamic</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="PC-Binary-Installation.html#PC-Binary-Installation">PC Binary Installation</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="PC-Installation.html#PC-Installation">PC Installation</a>
<hr>
</div>

<h5 class="appendixsubsubsec">B.3.3.2 Compiling <samp><span class="command">gawk</span></samp> for PC Operating Systems</h5>

<p><samp><span class="command">gawk</span></samp> can be compiled for MS-DOS, Windows32, and OS/2 using the GNU
development tools from DJ Delorie (DJGPP; MS-DOS only) or Eberhard
Mattes (EMX; MS-DOS, Windows32 and OS/2).  Microsoft Visual C/C++ can be used
to build a Windows32 version, and Microsoft C/C++ can be
used to build 16-bit versions for MS-DOS and OS/2. 
<!-- FIXME: -->
(As of <samp><span class="command">gawk</span></samp> 3.1.2, the MSC version doesn't work. However,
the maintainer is working on fixing it.) 
The file
<samp><span class="file">README_d/README.pc</span></samp> in the <samp><span class="command">gawk</span></samp> distribution contains
additional notes, and <samp><span class="file">pc/Makefile</span></samp> contains important information on
compilation options.

   <p>To build <samp><span class="command">gawk</span></samp> for MS-DOS, Windows32, and OS/2 (16 bit only; for 32 bit
(EMX) you can use the <samp><span class="command">configure</span></samp> script and skip the following paragraphs;
for details see below), copy the files in the <samp><span class="file">pc</span></samp> directory (<em>except</em>
for <samp><span class="file">ChangeLog</span></samp>) to the directory with the rest of the <samp><span class="command">gawk</span></samp>
sources. The <samp><span class="file">Makefile</span></samp> contains a configuration section with comments and
may need to be edited in order to work with your <samp><span class="command">make</span></samp> utility.

   <p>The <samp><span class="file">Makefile</span></samp> contains a number of targets for building various MS-DOS,
Windows32, and OS/2 versions. A list of targets is printed if the <samp><span class="command">make</span></samp>
command is given without a target. As an example, to build <samp><span class="command">gawk</span></samp>
using the DJGPP tools, enter &lsquo;<samp><span class="samp">make djgpp</span></samp>&rsquo;. 
(The DJGPP tools may be found at
<a href="ftp://ftp.delorie.com/pub/djgpp/current/v2gnu/">ftp://ftp.delorie.com/pub/djgpp/current/v2gnu/</a>.)

   <p>Using <samp><span class="command">make</span></samp> to run the standard tests and to install <samp><span class="command">gawk</span></samp>
requires additional Unix-like tools, including <samp><span class="command">sh</span></samp>, <samp><span class="command">sed</span></samp>, and
<samp><span class="command">cp</span></samp>. In order to run the tests, the <samp><span class="file">test/*.ok</span></samp> files may need to
be converted so that they have the usual DOS-style end-of-line markers. Most
of the tests work properly with Stewartson's shell along with the
companion utilities or appropriate GNU utilities.  However, some editing of
<samp><span class="file">test/Makefile</span></samp> is required. It is recommended that you copy the file
<samp><span class="file">pc/Makefile.tst</span></samp> over the file <samp><span class="file">test/Makefile</span></samp> as a
replacement. Details can be found in <samp><span class="file">README_d/README.pc</span></samp>
and in the file <samp><span class="file">pc/Makefile.tst</span></samp>.

   <p>The 32 bit EMX version of <samp><span class="command">gawk</span></samp> works &ldquo;out of the box&rdquo; under OS/2. 
In principle, it is possible to compile <samp><span class="command">gawk</span></samp> the following way:

<pre class="example">     $ ./configure
     $ make
</pre>
   <p>This is not recommended, though. To get an OMF executable you should
use the following commands at your <samp><span class="command">sh</span></samp> prompt:

<pre class="example">     $ CPPFLAGS="-D__ST_MT_ERRNO__"
     $ export CPPFLAGS
     $ CFLAGS="-O2 -Zomf -Zmt"
     $ export CFLAGS
     $ LDFLAGS="-s -Zcrtdll -Zlinker /exepack:2 -Zlinker /pm:vio -Zstack 0x6000"
     $ export LDFLAGS
     $ RANLIB="echo"
     $ export RANLIB
     $ ./configure --prefix=c:/usr --without-included-gettext
     $ make AR=emxomfar
</pre>
   <p>These are just suggestions. You may use any other set of (self-consistent)
environment variables and compiler flags.

   <p>To get an FHS-compliant file hierarchy it is recommended to use the additional
<samp><span class="command">configure</span></samp> options <samp><span class="option">--infodir=c:/usr/share/info</span></samp>, <samp><span class="option">--mandir=c:/usr/share/man</span></samp>
and <samp><span class="option">--libexecdir=c:/usr/lib</span></samp>.

   <p>If you use GCC 2.95 it is recommended to use also:

<pre class="example">     $ LIBS="-lgcc"
     $ export LIBS
</pre>
   <p>You can also get an <code>a.out</code> executable if you prefer:

<pre class="example">     $ CPPFLAGS="-D__ST_MT_ERRNO__"
     $ export CPPFLAGS
     $ CFLAGS="-O2 -Zmt"
     $ export CFLAGS
     $ LDFLAGS="-s -Zstack 0x6000"
     $ LIBS="-lgcc"
     $ unset RANLIB
     <!-- $ ./configure -prefix=c:/usr -without-included-gettext -->
     $ ./configure --prefix=c:/usr
     $ make
</pre>
   <blockquote>
<b>NOTE:</b> Versions later than GCC 2.95, i.e., GCC 3.x using the Innotek libc were not tested. 
</blockquote>

   <blockquote>
<b>NOTE:</b> Even if the compiled <samp><span class="command">gawk.exe</span></samp> (<code>a.out</code>) executable
contains a DOS header, it does <em>not</em> work under DOS. To compile an executable
that runs under DOS, <code>"-DPIPES_SIMULATED"</code> must be added to <samp><span class="env">CPPFLAGS</span></samp>. 
But then some nonstandard extensions of <samp><span class="command">gawk</span></samp> (e.g., &lsquo;<samp><span class="samp">|&amp;</span></samp>&rsquo;) do not work! 
</blockquote>

   <p>After compilation the internal tests can be performed. Enter
&lsquo;<samp><span class="samp">make check CMP="diff -a"</span></samp>&rsquo; at your command prompt. All tests
except for the <code>pid</code> test are expected to work properly. 
The <code>pid</code> test fails because child processes are not started by
<code>fork()</code>.

   <p>&lsquo;<samp><span class="samp">make install</span></samp>&rsquo; works as expected.

   <blockquote>
<b>NOTE:</b> Most OS/2 ports of GNU <samp><span class="command">make</span></samp> are not able to handle
the Makefiles of this package. If you encounter any problems with <samp><span class="command">make</span></samp>
try GNU Make 3.79.1 or later versions. You should find the latest
version on
<!-- @uref{http://www.unixos2.org/sw/pub/binary/make/} or on -->
<a href="ftp://hobbes.nmsu.edu/pub/os2/">ftp://hobbes.nmsu.edu/pub/os2/</a>. 
</blockquote>

   </body></html>

