<html lang="en">
<head>
<title>I/O Functions - The GNU Awk User's Guide</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="The GNU Awk User's Guide">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Built_002din.html#Built_002din" title="Built-in">
<link rel="prev" href="String-Functions.html#String-Functions" title="String Functions">
<link rel="next" href="Time-Functions.html#Time-Functions" title="Time Functions">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
Copyright (C) 1989, 1991, 1992, 1993, 1996, 1997, 1998, 1999,
2000, 2001, 2002, 2003, 2004, 2005, 2007, 2009 Free Software Foundation, Inc.



   This is Edition 3 of `GAWK: Effective AWK Programming: A User's Guide for GNU Awk',
for the 3.1.7 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being ``GNU General Public License'', the Front-Cover
texts being (a) (see below), and with the Back-Cover Texts being (b)
(see below).  A copy of the license is included in the section entitled
``GNU Free Documentation License''.
  a. ``A GNU Manual''

  b. ``You have the freedom to copy and modify this GNU manual.  Buying
     copies from the FSF supports it in developing GNU and promoting
     software freedom.''
        -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="I%2fO-Functions"></a>
<a name="I_002fO-Functions"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="Time-Functions.html#Time-Functions">Time Functions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="String-Functions.html#String-Functions">String Functions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Built_002din.html#Built_002din">Built-in</a>
<hr>
</div>

<h4 class="subsection">8.1.4 Input/Output Functions</h4>

<p>The following functions relate to input/output (I/O). 
Optional parameters are enclosed in square brackets ([ ]):

     <dl>
<dt><code>close(</code><var>filename</var> <span class="roman">[</span><code>, </code><var>how</var><span class="roman">]</span><code>)</code><dd><a name="index-g_t_0040code_007bclose_007d-function-1218"></a><a name="index-files_002c-closing-1219"></a>Close the file <var>filename</var> for input or output. Alternatively, the
argument may be a shell command that was used for creating a coprocess, or
for redirecting to or from a pipe; then the coprocess or pipe is closed. 
See <a href="Close-Files-And-Pipes.html#Close-Files-And-Pipes">Close Files And Pipes</a>,
for more information.

     <p>When closing a coprocess, it is occasionally useful to first close
one end of the two-way pipe and then to close the other.  This is done
by providing a second argument to <code>close</code>.  This second argument
should be one of the two string values <code>"to"</code> or <code>"from"</code>,
indicating which end of the pipe to close.  Case in the string does
not matter. 
See <a href="Two_002dway-I_002fO.html#Two_002dway-I_002fO">Two-way I/O</a>,
which discusses this feature in more detail and gives an example.

     <br><dt><code>fflush(</code><span class="roman">[</span><var>filename</var><span class="roman">]</span><code>)</code><dd><a name="index-g_t_0040code_007bfflush_007d-function-1220"></a>Flush any buffered output associated with <var>filename</var>, which is either a
file opened for writing or a shell command for redirecting output to
a pipe or coprocess.

     <p><a name="index-portability_002c-_0040code_007bfflush_007d-function-and-1221"></a><a name="index-buffers_002c-flushing-1222"></a><a name="index-output_002c-buffering-1223"></a>Many utility programs <dfn>buffer</dfn> their output; i.e., they save information
to write to a disk file or terminal in memory until there is enough
for it to be worthwhile to send the data to the output device. 
This is often more efficient than writing
every little bit of information as soon as it is ready.  However, sometimes
it is necessary to force a program to <dfn>flush</dfn> its buffers; that is,
write the information to its destination, even if a buffer is not full. 
This is the purpose of the <code>fflush</code> function&mdash;<samp><span class="command">gawk</span></samp> also
buffers its output and the <code>fflush</code> function forces
<samp><span class="command">gawk</span></samp> to flush its buffers.

     <p><code>fflush</code> was added to the Bell Laboratories research
version of <samp><span class="command">awk</span></samp> in 1994; it is not part of the POSIX standard and is
not available if <samp><span class="option">--posix</span></samp> has been specified on the
command line (see <a href="Options.html#Options">Options</a>).

     <p><a name="index-g_t_0040command_007bgawk_007d_002c-_0040code_007bfflush_007d-function-in-1224"></a><samp><span class="command">gawk</span></samp> extends the <code>fflush</code> function in two ways.  The first
is to allow no argument at all. In this case, the buffer for the
standard output is flushed.  The second is to allow the null string
(<code>""</code><!-- /@w -->) as the argument. In this case, the buffers for
<em>all</em> open output files and pipes are flushed. 
Current versions of the Bell Labs <samp><span class="command">awk</span></samp> also
support these extensions. 
<!-- As of 2002, but I didn't know about it until 4/2009! -->

     <!-- @cindex automatic warnings -->
     <!-- @cindex warnings, automatic -->
     <p><a name="index-troubleshooting_002c-_0040code_007bfflush_007d-function-1225"></a><code>fflush</code> returns zero if the buffer is successfully flushed;
otherwise, it returns &minus;1. 
In the case where all buffers are flushed, the return value is zero
only if all buffers were flushed successfully.  Otherwise, it is
&minus;1, and <samp><span class="command">gawk</span></samp> warns about the problem <var>filename</var>.

     <p><samp><span class="command">gawk</span></samp> also issues a warning message if you attempt to flush
a file or pipe that was opened for reading (such as with <code>getline</code>),
or if <var>filename</var> is not an open file, pipe, or coprocess. 
In such a case, <code>fflush</code> returns &minus;1, as well.

     <br><dt><code>system(</code><var>command</var><code>)</code><dd><a name="index-g_t_0040code_007bsystem_007d-function-1226"></a><a name="index-interacting-with-other-programs-1227"></a>Executes operating-system
commands and then returns to the <samp><span class="command">awk</span></samp> program.  The <code>system</code>
function executes the command given by the string <var>command</var>. 
It returns the status returned by the command that was executed as
its value.

     <p>For example, if the following fragment of code is put in your <samp><span class="command">awk</span></samp>
program:

     <pre class="example">          END {
               system("date | mail -s 'awk run done' root")
          }
</pre>
     <p class="noindent">the system administrator is sent mail when the <samp><span class="command">awk</span></samp> program
finishes processing input and begins its end-of-input processing.

     <p>Note that redirecting <code>print</code> or <code>printf</code> into a pipe is often
enough to accomplish your task.  If you need to run many commands, it
is more efficient to simply print them down a pipeline to the shell:

     <pre class="example">          while (<var>more stuff to do</var>)
              print <var>command</var> | "/bin/sh"
          close("/bin/sh")
</pre>
     <p class="noindent"><a name="index-troubleshooting_002c-_0040code_007bsystem_007d-function-1228"></a>However, if your <samp><span class="command">awk</span></samp>
program is interactive, <code>system</code> is useful for cranking up large
self-contained programs, such as a shell or an editor. 
Some operating systems cannot implement the <code>system</code> function. 
<code>system</code> causes a fatal error if it is not supported. 
</dl>

<!-- fakenode - for prepinfo -->
<h4 class="subheading">Advanced Notes: Interactive Versus Noninteractive Buffering</h4>

<p><a name="index-advanced-features_002c-buffering-1229"></a><a name="index-buffering_002c-interactive-vs_002e_0040_003a-noninteractive-1230"></a>
As a side point, buffering issues can be even more confusing, depending
upon whether your program is <dfn>interactive</dfn>, i.e., communicating
with a user sitting at a keyboard.<a rel="footnote" href="#fn-1" name="fnd-1"><sup>1</sup></a>

<!-- Thanks to Walter.Mecky@dresdnerbank.de for this example, and for -->
<!-- motivating me to write this section. -->
   <p>Interactive programs generally <dfn>line buffer</dfn> their output; i.e., they
write out every line.  Noninteractive programs wait until they have
a full buffer, which may be many lines of output. 
Here is an example of the difference:

<pre class="example">     $ awk '{ print $1 + $2 }'
     1 1
     -| 2
     2 3
     -| 5
     <kbd>Ctrl-d</kbd>
</pre>
   <p class="noindent">Each line of output is printed immediately. Compare that behavior
with this example:

<pre class="example">     $ awk '{ print $1 + $2 }' | cat
     1 1
     2 3
     <kbd>Ctrl-d</kbd>
     -| 2
     -| 5
</pre>
   <p class="noindent">Here, no output is printed until after the <kbd>Ctrl-d</kbd> is typed, because
it is all buffered and sent down the pipe to <samp><span class="command">cat</span></samp> in one shot.

<!-- fakenode - for prepinfo -->
<h4 class="subheading">Advanced Notes: Controlling Output Buffering with <code>system</code></h4>

<p><a name="index-advanced-features_002c-buffering-1231"></a><a name="index-buffers_002c-flushing-1232"></a><a name="index-buffering_002c-input_002foutput-1233"></a><a name="index-output_002c-buffering-1234"></a>
The <code>fflush</code> function provides explicit control over output buffering for
individual files and pipes.  However, its use is not portable to many other
<samp><span class="command">awk</span></samp> implementations.  An alternative method to flush output
buffers is to call <code>system</code> with a null string as its argument:

<pre class="example">     system("")   # flush output
</pre>
   <p class="noindent"><samp><span class="command">gawk</span></samp> treats this use of the <code>system</code> function as a special
case and is smart enough not to run a shell (or other command
interpreter) with the empty command.  Therefore, with <samp><span class="command">gawk</span></samp>, this
idiom is not only useful, it is also efficient.  While this method should work
with other <samp><span class="command">awk</span></samp> implementations, it does not necessarily avoid
starting an unnecessary shell.  (Other implementations may only
flush the buffer associated with the standard output and not necessarily
all buffered output.)

   <p>If you think about what a programmer expects, it makes sense that
<code>system</code> should flush any pending output.  The following program:

<pre class="example">     BEGIN {
          print "first print"
          system("echo system echo")
          print "second print"
     }
</pre>
   <p class="noindent">must print:

<pre class="example">     first print
     system echo
     second print
</pre>
   <p class="noindent">and not:

<pre class="example">     system echo
     first print
     second print
</pre>
   <p>If <samp><span class="command">awk</span></samp> did not flush its buffers before calling <code>system</code>,
you would see the latter (undesirable) output.

   <div class="footnote">
<hr>
<h4>Footnotes</h4><p class="footnote"><small>[<a name="fn-1" href="#fnd-1">1</a>]</small> A program is interactive
if the standard output is connected
to a terminal device.</p>

   <hr></div>

   </body></html>

