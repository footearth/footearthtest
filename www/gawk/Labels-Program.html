<html lang="en">
<head>
<title>Labels Program - The GNU Awk User's Guide</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="The GNU Awk User's Guide">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Miscellaneous-Programs.html#Miscellaneous-Programs" title="Miscellaneous Programs">
<link rel="prev" href="Translate-Program.html#Translate-Program" title="Translate Program">
<link rel="next" href="Word-Sorting.html#Word-Sorting" title="Word Sorting">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
Copyright (C) 1989, 1991, 1992, 1993, 1996, 1997, 1998, 1999,
2000, 2001, 2002, 2003, 2004, 2005, 2007, 2009 Free Software Foundation, Inc.



   This is Edition 3 of `GAWK: Effective AWK Programming: A User's Guide for GNU Awk',
for the 3.1.7 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being ``GNU General Public License'', the Front-Cover
texts being (a) (see below), and with the Back-Cover Texts being (b)
(see below).  A copy of the license is included in the section entitled
``GNU Free Documentation License''.
  a. ``A GNU Manual''

  b. ``You have the freedom to copy and modify this GNU manual.  Buying
     copies from the FSF supports it in developing GNU and promoting
     software freedom.''
        -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Labels-Program"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="Word-Sorting.html#Word-Sorting">Word Sorting</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Translate-Program.html#Translate-Program">Translate Program</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Miscellaneous-Programs.html#Miscellaneous-Programs">Miscellaneous Programs</a>
<hr>
</div>

<h4 class="subsection">13.3.4 Printing Mailing Labels</h4>

<!-- STARTOFRANGE prml -->
<p><a name="index-printing_002c-mailing-labels-1814"></a><!-- STARTOFRANGE mlprint -->
<a name="index-mailing-labels_0040comma_007b_007d-printing-1815"></a>Here is a &ldquo;real world&rdquo;<a rel="footnote" href="#fn-1" name="fnd-1"><sup>1</sup></a>
program.  This
script reads lists of names and
addresses and generates mailing labels.  Each page of labels has 20 labels
on it, 2 across and 10 down.  The addresses are guaranteed to be no more
than 5 lines of data.  Each address is separated from the next by a blank
line.

   <p>The basic idea is to read 20 labels worth of data.  Each line of each label
is stored in the <code>line</code> array.  The single rule takes care of filling
the <code>line</code> array and printing the page when 20 labels have been read.

   <p>The <code>BEGIN</code> rule simply sets <code>RS</code> to the empty string, so that
<samp><span class="command">awk</span></samp> splits records at blank lines
(see <a href="Records.html#Records">Records</a>). 
It sets <code>MAXLINES</code> to 100, since 100 is the maximum number
of lines on the page (20 * 5 = 100).

   <p>Most of the work is done in the <code>printpage</code> function. 
The label lines are stored sequentially in the <code>line</code> array.  But they
have to print horizontally; <code>line[1]</code> next to <code>line[6]</code>,
<code>line[2]</code> next to <code>line[7]</code>, and so on.  Two loops are used to
accomplish this.  The outer loop, controlled by <code>i</code>, steps through
every 10 lines of data; this is each row of labels.  The inner loop,
controlled by <code>j</code>, goes through the lines within the row. 
As <code>j</code> goes from 0 to 4, &lsquo;<samp><span class="samp">i+j</span></samp>&rsquo; is the <code>j</code>-th line in
the row, and &lsquo;<samp><span class="samp">i+j+5</span></samp>&rsquo; is the entry next to it.  The output ends up
looking something like this:

<pre class="example">     line 1          line 6
     line 2          line 7
     line 3          line 8
     line 4          line 9
     line 5          line 10
     ...
</pre>
   <p>As a final note, an extra blank line is printed at lines 21 and 61, to keep
the output lined up on the labels.  This is dependent on the particular
brand of labels in use when the program was written.  You will also note
that there are 2 blank lines at the top and 2 blank lines at the bottom.

   <p>The <code>END</code> rule arranges to flush the final page of labels; there may
not have been an even multiple of 20 labels in the data:

   <p><a name="index-g_t_0040code_007blabels_002eawk_007d-program-1816"></a>
<pre class="example">     <!-- file eg/prog/labels.awk -->
     # labels.awk --- print mailing labels
     <!-- endfile -->
     <!-- file eg/prog/labels.awk -->
     
     # Each label is 5 lines of data that may have blank lines.
     # The label sheets have 2 blank lines at the top and 2 at
     # the bottom.
     
     BEGIN    { RS = "" ; MAXLINES = 100 }
     
     function printpage(    i, j)
     {
         if (Nlines &lt;= 0)
             return
     
         printf "\n\n"        # header
     
         for (i = 1; i &lt;= Nlines; i += 10) {
             if (i == 21 || i == 61)
                 print ""
             for (j = 0; j &lt; 5; j++) {
                 if (i + j &gt; MAXLINES)
                     break
                 printf "   %-41s %s\n", line[i+j], line[i+j+5]
             }
             print ""
         }
     
         printf "\n\n"        # footer
     
         for (i in line)
             line[i] = ""
     }
     
     # main rule
     {
         if (Count &gt;= 20) {
             printpage()
             Count = 0
             Nlines = 0
         }
         n = split($0, a, "\n")
         for (i = 1; i &lt;= n; i++)
             line[++Nlines] = a[i]
         for (; i &lt;= 5; i++)
             line[++Nlines] = ""
         Count++
     }
     
     END    \
     {
         printpage()
     }
     <!-- endfile -->
</pre>
   <!-- ENDOFRANGE prml -->
<!-- ENDOFRANGE mlprint -->
   <div class="footnote">
<hr>
<h4>Footnotes</h4><p class="footnote"><small>[<a name="fn-1" href="#fnd-1">1</a>]</small> &ldquo;Real world&rdquo; is defined as
&ldquo;a program actually used to get something done.&rdquo;</p>

   <hr></div>

   </body></html>

