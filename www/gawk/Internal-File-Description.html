<html lang="en">
<head>
<title>Internal File Description - The GNU Awk User's Guide</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="The GNU Awk User's Guide">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Sample-Library.html#Sample-Library" title="Sample Library">
<link rel="next" href="Internal-File-Ops.html#Internal-File-Ops" title="Internal File Ops">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
Copyright (C) 1989, 1991, 1992, 1993, 1996, 1997, 1998, 1999,
2000, 2001, 2002, 2003, 2004, 2005, 2007, 2009 Free Software Foundation, Inc.



   This is Edition 3 of `GAWK: Effective AWK Programming: A User's Guide for GNU Awk',
for the 3.1.7 (or later) version of the GNU
implementation of AWK.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being ``GNU General Public License'', the Front-Cover
texts being (a) (see below), and with the Back-Cover Texts being (b)
(see below).  A copy of the license is included in the section entitled
``GNU Free Documentation License''.
  a. ``A GNU Manual''

  b. ``You have the freedom to copy and modify this GNU manual.  Buying
     copies from the FSF supports it in developing GNU and promoting
     software freedom.''
        -->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="Internal-File-Description"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="Internal-File-Ops.html#Internal-File-Ops">Internal File Ops</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Sample-Library.html#Sample-Library">Sample Library</a>
<hr>
</div>

<h5 class="appendixsubsubsec">C.3.2.1 Using <code>chdir</code> and <code>stat</code></h5>

<p>This section shows how to use the new functions at the <samp><span class="command">awk</span></samp>
level once they've been integrated into the running <samp><span class="command">gawk</span></samp>
interpreter. 
Using <code>chdir</code> is very straightforward. It takes one argument,
the new directory to change to:

<pre class="example">     ...
     newdir = "/home/arnold/funstuff"
     ret = chdir(newdir)
     if (ret &lt; 0) {
         printf("could not change to %s: %s\n",
                        newdir, ERRNO) &gt; "/dev/stderr"
         exit 1
     }
     ...
</pre>
   <p>The return value is negative if the <code>chdir</code> failed,
and <code>ERRNO</code>
(see <a href="Built_002din-Variables.html#Built_002din-Variables">Built-in Variables</a>)
is set to a string indicating the error.

   <p>Using <code>stat</code> is a bit more complicated. 
The C <code>stat</code> function fills in a structure that has a fair
amount of information. 
The right way to model this in <samp><span class="command">awk</span></samp> is to fill in an associative
array with the appropriate information:

<!-- broke printf for page breaking -->
<pre class="example">     file = "/home/arnold/.profile"
     fdata[1] = "x"    # force `fdata' to be an array
     ret = stat(file, fdata)
     if (ret &lt; 0) {
         printf("could not stat %s: %s\n",
                  file, ERRNO) &gt; "/dev/stderr"
         exit 1
     }
     printf("size of %s is %d bytes\n", file, fdata["size"])
</pre>
   <p>The <code>stat</code> function always clears the data array, even if
the <code>stat</code> fails.  It fills in the following elements:

     <dl>
<dt><code>"name"</code><dd>The name of the file that was <code>stat</code>'ed.

     <br><dt><code>"dev"</code><dt><code>"ino"</code><dd>The file's device and inode numbers, respectively.

     <br><dt><code>"mode"</code><dd>The file's mode, as a numeric value. This includes both the file's
type and its permissions.

     <br><dt><code>"nlink"</code><dd>The number of hard links (directory entries) the file has.

     <br><dt><code>"uid"</code><dt><code>"gid"</code><dd>The numeric user and group ID numbers of the file's owner.

     <br><dt><code>"size"</code><dd>The size in bytes of the file.

     <br><dt><code>"blocks"</code><dd>The number of disk blocks the file actually occupies. This may not
be a function of the file's size if the file has holes.

     <br><dt><code>"atime"</code><dt><code>"mtime"</code><dt><code>"ctime"</code><dd>The file's last access, modification, and inode update times,
respectively.  These are numeric timestamps, suitable for formatting
with <code>strftime</code>
(see <a href="Built_002din.html#Built_002din">Built-in</a>).

     <br><dt><code>"pmode"</code><dd>The file's &ldquo;printable mode.&rdquo;  This is a string representation of
the file's type and permissions, such as what is produced by
&lsquo;<samp><span class="samp">ls -l</span></samp>&rsquo;&mdash;for example, <code>"drwxr-xr-x"</code>.

     <br><dt><code>"type"</code><dd>A printable string representation of the file's type.  The value
is one of the following:

          <dl>
<dt><code>"blockdev"</code><dt><code>"chardev"</code><dd>The file is a block or character device (&ldquo;special file&rdquo;).

          <br><dt><code>"directory"</code><dd>The file is a directory.

          <br><dt><code>"fifo"</code><dd>The file is a named-pipe (also known as a FIFO).

          <br><dt><code>"file"</code><dd>The file is just a regular file.

          <br><dt><code>"socket"</code><dd>The file is an <code>AF_UNIX</code> (&ldquo;Unix domain&rdquo;) socket in the
filesystem.

          <br><dt><code>"symlink"</code><dd>The file is a symbolic link. 
</dl>
     </dl>

   <p>Several additional elements may be present depending upon the operating
system and the type of the file.  You can test for them in your <samp><span class="command">awk</span></samp>
program by using the <code>in</code> operator
(see <a href="Reference-to-Elements.html#Reference-to-Elements">Reference to Elements</a>):

     <dl>
<dt><code>"blksize"</code><dd>The preferred block size for I/O to the file. This field is not
present on all POSIX-like systems in the C <code>stat</code> structure.

     <br><dt><code>"linkval"</code><dd>If the file is a symbolic link, this element is the name of the
file the link points to (i.e., the value of the link).

     <br><dt><code>"rdev"</code><dt><code>"major"</code><dt><code>"minor"</code><dd>If the file is a block or character device file, then these values
represent the numeric device number and the major and minor components
of that number, respectively. 
</dl>

   </body></html>

